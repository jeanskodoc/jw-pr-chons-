<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prêchons - Application de Suivi des Prédications</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Styles généraux */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
            background-image: url('JW.jpeg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            background-blend-mode: overlay;
            background-color: rgba(245, 247, 250, 0.85); /* Plus transparent */
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: rgba(255, 255, 255, 0.88); /* Plus transparent */
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
            overflow: hidden;
            min-height: 100vh;
            backdrop-filter: blur(5px); /* Effet flou pour accentuer la transparence */
        }
        
        /* En-tête avec style JW */
        header {
            background: linear-gradient(to right, rgba(26, 71, 42, 0.9), rgba(46, 125, 50, 0.9)); /* Semi-transparent */
            color: white;
            padding: 20px 25px;
            text-align: center;
            position: relative;
            border-bottom: 4px solid #d4a017;
        }
        
        h1 {
            font-size: 2rem;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        .subtitle {
            font-size: 1rem;
            opacity: 0.9;
        }
        
        .jw-logo {
            font-family: 'Arial', sans-serif;
            font-weight: bold;
            font-size: 2.8rem;
            color: #ffffff;
            background-color: #d4a017;
            width: 70px;
            height: 70px;
            line-height: 70px;
            border-radius: 50%;
            margin: 0 auto 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
            border: 3px solid white;
        }
        
        .jw-logo span {
            font-size: 2rem;
            letter-spacing: -1px;
        }
        
        /* Onglets améliorés */
        .tabs-container {
            display: flex;
            background-color: rgba(241, 245, 249, 0.9); /* Semi-transparent */
            border-bottom: 1px solid #ddd;
            overflow-x: auto;
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 14px 16px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            color: #2c3e50;
            white-space: nowrap;
            min-width: 120px;
            flex: 1;
        }
        
        .tab:hover {
            background-color: rgba(226, 232, 240, 0.8);
            color: #1a472a;
        }
        
        .tab.active {
            background-color: rgba(255, 255, 255, 0.95);
            color: #1a472a;
            border-bottom: 3px solid #d4a017;
        }
        
        .tab i {
            margin-right: 8px;
            font-size: 1.1rem;
        }
        
        /* Contenu des onglets */
        .tab-content {
            display: none;
            padding: 20px;
            animation: fadeIn 0.5s ease;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Formulaires compacts */
        .form-row {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 20px;
            gap: 15px;
        }
        
        .form-group {
            flex: 1;
            min-width: 200px;
        }
        
        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #1a472a;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95rem;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 15px;
            transition: border 0.3s;
            background-color: rgba(248, 249, 250, 0.9);
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #2e7d32;
            box-shadow: 0 0 0 2px rgba(46, 125, 50, 0.2);
        }
        
        /* Boutons compacts */
        .action-buttons {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        
        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s ease;
            min-width: 140px;
            white-space: nowrap;
        }
        
        .btn-primary {
            background-color: #2e7d32;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #1b5e20;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background-color: #388e3c;
            color: white;
        }
        
        .btn-success:hover {
            background-color: #2e7d32;
            transform: translateY(-2px);
        }
        
        .btn-whatsapp {
            background-color: #25D366;
            color: white;
        }
        
        .btn-whatsapp:hover {
            background-color: #1da851;
            transform: translateY(-2px);
        }
        
        .btn-import {
            background-color: #f57c00;
            color: white;
        }
        
        .btn-import:hover {
            background-color: #ef6c00;
            transform: translateY(-2px);
        }
        
        .btn-export {
            background-color: #7b1fa2;
            color: white;
        }
        
        .btn-export:hover {
            background-color: #6a1b9a;
            transform: translateY(-2px);
        }
        
        .btn-search {
            background-color: #d32f2f;
            color: white;
        }
        
        .btn-search:hover {
            background-color: #c62828;
            transform: translateY(-2px);
        }
        
        .btn-gps {
            background-color: #455a64;
            color: white;
        }
        
        .btn-gps:hover {
            background-color: #37474f;
            transform: translateY(-2px);
        }
        
        .btn-map {
            background-color: #d32f2f;
            color: white;
        }
        
        .btn-map:hover {
            background-color: #c62828;
            transform: translateY(-2px);
        }
        
        .btn-position {
            background-color: #1976d2;
            color: white;
        }
        
        .btn-position:hover {
            background-color: #1565c0;
            transform: translateY(-2px);
        }
        
        /* Footer */
        footer {
            text-align: center;
            padding: 18px;
            margin-top: 20px;
            color: #555;
            font-size: 0.85rem;
            border-top: 1px solid #eee;
            background-color: rgba(248, 249, 250, 0.9);
        }
        
        /* Notifications */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 12px 20px;
            background-color: #2e7d32;
            color: white;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: none;
            z-index: 1000;
            animation: slideIn 0.3s ease;
            max-width: 300px;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* Éléments JW */
        .jw-decoration {
            position: absolute;
            opacity: 0.1;
            font-family: 'Arial', sans-serif;
            font-weight: bold;
            font-size: 3rem;
            color: white;
        }
        
        .jw-decoration.left {
            top: 15px;
            left: 20px;
        }
        
        .jw-decoration.right {
            bottom: 15px;
            right: 20px;
        }
        
        /* Section GPS - Nouveau style */
        .gps-section {
            background-color: rgba(232, 244, 252, 0.85);
            padding: 18px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #2e7d32;
        }
        
        .gps-coordinates {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 10px;
        }
        
        .gps-coordinate {
            flex: 1;
            min-width: 200px;
        }
        
        .gps-info {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
            font-style: italic;
        }
        
        .gps-status {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .gps-status.active {
            background-color: #4caf50;
            color: white;
        }
        
        .gps-status.inactive {
            background-color: #f44336;
            color: white;
        }
        
        /* Trajectoire GPS */
        .trajectory-section {
            background-color: rgba(255, 243, 205, 0.85);
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border: 1px solid #ffb74d;
        }
        
        .trajectory-list {
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
            padding: 10px;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 5px;
        }
        
        .trajectory-point {
            padding: 8px;
            border-bottom: 1px solid #eee;
            font-size: 0.85rem;
        }
        
        /* Responsive design amélioré */
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 10px;
            }
            
            header {
                padding: 15px 20px;
            }
            
            h1 {
                font-size: 1.6rem;
            }
            
            .subtitle {
                font-size: 0.9rem;
            }
            
            .jw-logo {
                width: 60px;
                height: 60px;
                line-height: 60px;
                font-size: 2.4rem;
            }
            
            .jw-logo span {
                font-size: 1.8rem;
            }
            
            .tabs-container {
                flex-direction: column;
            }
            
            .tab {
                padding: 12px;
                min-width: auto;
                font-size: 0.95rem;
            }
            
            .form-row {
                flex-direction: column;
                gap: 12px;
            }
            
            .form-group {
                min-width: 100%;
            }
            
            .action-buttons {
                flex-direction: column;
                align-items: stretch;
            }
            
            .btn {
                width: 100%;
                min-width: unset;
                padding: 12px 16px;
            }
            
            .tab-content {
                padding: 15px;
            }
            
            .jw-decoration {
                display: none;
            }
            
            .gps-coordinate {
                min-width: 100%;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                margin: 5px;
            }
            
            header {
                padding: 12px 15px;
            }
            
            h1 {
                font-size: 1.4rem;
            }
            
            .subtitle {
                font-size: 0.85rem;
            }
            
            .btn {
                font-size: 13px;
                padding: 10px 14px;
            }
        }
        
        /* Styles pour les cartes/fiches */
        .carte-item {
            background-color: rgba(255, 255, 255, 0.95);
            padding: 18px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #d32f2f;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: transform 0.2s;
        }
        
        .carte-item:hover {
            transform: translateY(-3px);
        }
        
        /* Styles pour les statistiques */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .stat-card {
            background-color: rgba(248, 249, 250, 0.9);
            padding: 18px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #e2e8f0;
        }
        
        .stat-icon {
            font-size: 2rem;
            margin-bottom: 8px;
            color: #2e7d32;
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #1a472a;
        }
        
        /* Authentification */
        .auth-container {
            max-width: 400px;
            margin: 50px auto;
            background-color: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
            border-top: 4px solid #d4a017;
        }
        
        .auth-header {
            text-align: center;
            margin-bottom: 25px;
        }
        
        .auth-header h2 {
            color: #1a472a;
            margin-bottom: 10px;
        }
        
        /* Éléments de formulaire */
        .form-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid #2e7d32;
        }
        
        .form-title {
            color: #1a472a;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* Amélioration de la lisibilité sur fond d'image */
        .list-item, .activity-item, .carte-item, .activity-form, .carte-form {
            background-color: rgba(255, 255, 255, 0.98);
        }
        
        /* Barre d'outils de l'éditeur */
        .rich-editor-toolbar {
            background-color: #f8f9fa;
            padding: 10px;
            border-bottom: 1px solid #ddd;
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            justify-content: center;
        }
        
        .rich-editor-toolbar button {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 6px 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 13px;
            transition: all 0.2s;
        }
        
        /* Section recherche */
        .search-section {
            background-color: rgba(254, 243, 199, 0.9);
            padding: 18px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #fbbf24;
        }
        
        /* Badge JW */
        .jw-badge {
            display: inline-block;
            background-color: #d4a017;
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-left: 8px;
        }
        
        /* User info dans l'en-tête */
        .user-info {
            position: absolute;
            top: 15px;
            right: 15px;
            background-color: rgba(255, 255, 255, 0.15);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 6px;
            backdrop-filter: blur(5px);
        }
        
        /* Animation de secousse pour les erreurs */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        
        .shake {
            animation: shake 0.5s;
        }
        
        /* Classes manquantes */
        .auth-form-group {
            margin-bottom: 20px;
        }
        
        .auth-form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .auth-form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
        }
        
        .empty-list {
            text-align: center;
            padding: 40px 20px;
            color: #94a3b8;
        }
        
        .empty-list i {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: #cbd5e1;
        }
        
        .list-item {
            background-color: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #3498db;
            transition: transform 0.2s;
        }
        
        .activity-item {
            background-color: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #9b59b6;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        /* Styles spécifiques pour le rapport d'activité */
        .rapport-form {
            background-color: rgba(248, 249, 250, 0.9);
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            border: 1px solid #e2e8f0;
        }
        
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 10px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 200px;
        }
        
        .checkbox-item input[type="checkbox"] {
            width: auto;
        }
        
        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .radio-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .radio-item input[type="radio"] {
            width: auto;
        }
        
        .number-input {
            max-width: 100px;
        }
        
        .section-title {
            color: #1a472a;
            margin: 25px 0 15px 0;
            padding-bottom: 10px;
            border-bottom: 2px solid #2e7d32;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title:first-child {
            margin-top: 0;
        }
        
        .form-help {
            font-size: 0.85rem;
            color: #64748b;
            margin-top: 5px;
            font-style: italic;
        }
        
        /* Style pour l'onglet rapport */
        .tab[data-tab="rapport"] {
            background-color: #e8f5e9;
        }
        
        .tab[data-tab="rapport"].active {
            background-color: white;
        }
        
        /* Styles spécifiques pour l'onglet Réunion */
        .reunion-form {
            background-color: rgba(248, 249, 250, 0.9);
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            border: 1px solid #e2e8f0;
        }
        
        .sous-section {
            background-color: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
            border-left: 4px solid #9b59b6;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .sous-section h4 {
            color: #1a472a;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .small-input {
            max-width: 150px;
        }
        
        .medium-input {
            max-width: 250px;
        }
        
        .topic-row {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }
        
        .topic-row label {
            min-width: 180px;
            margin-bottom: 0;
        }
        
        .optional-note {
            font-size: 0.8rem;
            color: #7f8c8d;
            font-style: italic;
            margin-top: 3px;
        }
        
        .link-input-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .link-input-group input {
            flex: 1;
        }
        
        .test-whatsapp-btn {
            padding: 8px 12px;
            background-color: #25D366;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .test-whatsapp-btn:hover {
            background-color: #1da851;
        }
    </style>
</head>
<body>
    <!-- Interface d'authentification -->
    <div id="authContainer" class="auth-container" style="display: block;">
        <div class="auth-header">
            <div class="jw-logo" style="width: 60px; height: 60px; line-height: 60px; font-size: 2.5rem; margin-bottom: 15px;">
                <span>JW</span>
            </div>
            <h2>Accès Protégé</h2>
            <p>Veuillez vous identifier pour accéder à l'onglet RDV</p>
        </div>
        
        <form id="authForm">
            <div class="auth-form-group">
                <label for="username"><i class="fas fa-user"></i> Identifiant</label>
                <input type="text" id="username" name="username" placeholder="Entrez votre identifiant" required>
            </div>
            
            <div class="auth-form-group">
                <label for="password"><i class="fas fa-lock"></i> Mot de passe</label>
                <input type="password" id="password" name="password" placeholder="Entrez votre mot de passe" required>
            </div>
            
            <button type="submit" class="btn btn-success" style="width: 100%; padding: 12px;">
                <i class="fas fa-sign-in-alt"></i> Se connecter
            </button>
            
            <div id="authError" class="auth-error" style="color: #d32f2f; text-align: center; margin-top: 15px; font-size: 0.9rem; display: none;">
                <i class="fas fa-exclamation-circle"></i> Identifiant ou mot de passe incorrect
            </div>
            
            <div style="margin-top: 20px; font-size: 0.85rem; color: #555; text-align: center; background-color: #f8f9fa; padding: 12px; border-radius: 6px;">
                <p><strong>Identifiant:</strong> KARA NORD</p>
                <p><strong>Mot de passe:</strong> KARA1@</p>
            </div>
        </form>
    </div>
    
    <!-- Interface principale (cachée par défaut) -->
    <div id="mainContainer" class="container" style="display: none;">
        <header>
            <div class="jw-decoration left">JW</div>
            <div class="jw-decoration right">JW</div>
            
            <div id="userInfo" class="user-info" style="display: none;">
                <i class="fas fa-user-circle"></i>
                <span id="currentUser"></span>
                <button type="button" id="logoutBtn" class="logout-btn" title="Se déconnecter" style="background: none; border: none; color: white; cursor: pointer; padding: 2px 6px; border-radius: 4px;">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
            
            <div class="jw-logo">
                <span>JW</span>
            </div>
            <h1>Prêchons</h1>
            <p class="subtitle">Application de suivi des activités de prédication</p>
        </header>
        
        <div class="tabs-container">
            <div class="tab active" data-tab="rdv" id="rdvTab">
                <i class="fas fa-calendar-check"></i> RDV
            </div>
            <div class="tab" data-tab="cahier">
                <i class="fas fa-book"></i> Cahier
            </div>
            <div class="tab" data-tab="carte">
                <i class="fas fa-map"></i> CARTE
            </div>
            <div class="tab" data-tab="rapport">
                <i class="fas fa-file-alt"></i> Rapport
            </div>
            <div class="tab" data-tab="reunion">
                <i class="fas fa-users"></i> Réunion
            </div>
            <div class="tab" data-tab="liste">
                <i class="fas fa-list"></i> Liste
            </div>
            <div class="tab" data-tab="statistiques">
                <i class="fas fa-chart-bar"></i> Stats
            </div>
        </div>
        
        <!-- Onglet RDV (protégé) -->
        <div id="rdv-tab" class="tab-content active">
            <!-- Message d'accès refusé -->
            <div id="accessDenied" class="access-denied" style="display: none; background-color: #fff3cd; border: 1px solid #ffeaa7; padding: 20px; border-radius: 8px; margin-bottom: 20px; color: #856404;">
                <h4 style="color: #856404; margin-bottom: 10px; display: flex; align-items: center; gap: 10px;"><i class="fas fa-lock"></i> Accès Restreint</h4>
                <p>L'accès à l'onglet RDV est réservé aux membres autorisés du groupe KARA NORD.</p>
                <p>Veuillez vous connecter pour accéder à cette fonctionnalité.</p>
                <button type="button" id="loginFromDeniedBtn" class="btn btn-primary" style="margin-top: 15px;">
                    <i class="fas fa-sign-in-alt"></i> Se connecter
                </button>
            </div>
            
            <!-- Contenu RDV -->
            <div id="rdvContent" style="display: none;">
                <div class="form-header">
                    <div class="form-title">
                        <i class="fas fa-calendar-check"></i>
                        <span id="formTitle">Nouvelle prédication</span>
                    </div>
                    <div id="formMode" class="form-mode-indicator" style="display: none; background-color: #f57c00; color: white; padding: 4px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: 600;">
                        Mode édition
                    </div>
                </div>
                
                <!-- Section GPS pour RDV -->
                <div class="gps-section">
                    <h3 style="color: #1a472a; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-map-marker-alt"></i> Géolocalisation GPS
                    </h3>
                    
                    <div class="gps-coordinates">
                        <div class="gps-coordinate">
                            <label for="latitude"><i class="fas fa-latitude"></i> Latitude</label>
                            <input type="text" id="latitude" name="latitude" readonly placeholder="Cliquez sur 'Obtenir GPS'">
                        </div>
                        
                        <div class="gps-coordinate">
                            <label for="longitude"><i class="fas fa-longitude"></i> Longitude</label>
                            <input type="text" id="longitude" name="longitude" readonly placeholder="Cliquez sur 'Obtenir GPS'">
                        </div>
                        
                        <div class="gps-coordinate">
                            <label for="accuracy"><i class="fas fa-crosshairs"></i> Précision</label>
                            <input type="text" id="accuracy" name="accuracy" readonly placeholder="Mètres">
                        </div>
                    </div>
                    
                    <div class="gps-info" id="gpsStatus">
                        Statut GPS: <span class="gps-status inactive" id="gpsStatusText">Non actif</span>
                    </div>
                    
                    <div style="margin-top: 15px; display: flex; gap: 10px; flex-wrap: wrap;">
                        <button type="button" id="getGpsBtn" class="btn btn-gps">
                            <i class="fas fa-satellite"></i> Obtenir position GPS
                        </button>
                        
                        <button type="button" id="clearGpsBtn" class="btn" style="background-color: #757575; color: white;">
                            <i class="fas fa-trash-alt"></i> Effacer GPS
                        </button>
                        
                        <button type="button" id="viewMapBtn" class="btn btn-map">
                            <i class="fas fa-external-link-alt"></i> Voir sur carte
                        </button>
                    </div>
                    
                    <!-- Section trajectoire -->
                    <div class="trajectory-section" id="trajectorySection" style="display: none;">
                        <h4 style="color: #f57c00; margin-bottom: 10px; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-route"></i> Trajectoire enregistrée
                        </h4>
                        <div class="trajectory-list" id="trajectoryList">
                            <!-- Les points de trajectoire seront ajoutés ici -->
                        </div>
                        <button type="button" id="clearTrajectoryBtn" class="btn" style="background-color: #f57c00; color: white; margin-top: 10px; padding: 6px 12px; font-size: 0.9rem;">
                            <i class="fas fa-trash-alt"></i> Effacer trajectoire
                        </button>
                    </div>
                </div>
                
                <form id="preachingForm">
                    <input type="hidden" id="editingId" name="editingId" value="">
                    <input type="hidden" id="gpsCoordinates" name="gpsCoordinates" value="">
                    <input type="hidden" id="gpsTrajectory" name="gpsTrajectory" value="">
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="date"><i class="fas fa-calendar-alt"></i> Date</label>
                            <input type="date" id="date" name="date" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="location"><i class="fas fa-map-marker-alt"></i> Lieu</label>
                            <input type="text" id="location" name="location" placeholder="Lieu de prédication" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="group"><i class="fas fa-users"></i> Groupe</label>
                            <select id="group" name="group" required>
                                <option value="">Sélectionnez un groupe</option>
                                <option value="Groupe 1">Groupe 1</option>
                                <option value="Groupe 2">Groupe 2</option>
                                <option value="Groupe 3">Groupe 3</option>
                                <option value="Groupe 4">Groupe 4</option>
                                <option value="Groupe 5">Groupe 5</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="neighborhood"><i class="fas fa-city"></i> Quartier</label>
                            <input type="text" id="neighborhood" name="neighborhood" placeholder="Quartier" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="preaching"><i class="fas fa-book"></i> Notes</label>
                            <textarea id="preaching" name="preaching" rows="4" placeholder="Notes de prédication..."></textarea>
                        </div>
                    </div>
                    
                    <div class="action-buttons">
                        <button type="button" id="importBtn" class="btn btn-import">
                            <i class="fas fa-file-import"></i> Importer
                        </button>
                        
                        <button type="button" id="exportBtn" class="btn btn-export">
                            <i class="fas fa-file-export"></i> Exporter
                        </button>
                        
                        <button type="button" id="whatsappBtn" class="btn btn-whatsapp">
                            <i class="fab fa-whatsapp"></i> WhatsApp
                        </button>
                        
                        <button type="submit" id="saveBtn" class="btn btn-success">
                            <i class="fas fa-save"></i> Enregistrer
                        </button>
                        
                        <button type="button" id="cancelEditBtn" class="btn" style="background-color: #757575; color: white; display: none;">
                            <i class="fas fa-times"></i> Annuler
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Onglet Cahier d'activité -->
        <div id="cahier-tab" class="tab-content">
            <div class="form-header">
                <div class="form-title">
                    <i class="fas fa-book"></i>
                    <span id="activityFormTitle">Nouvelle activité</span>
                </div>
                <div id="activityFormMode" class="form-mode-indicator" style="display: none; background-color: #f57c00; color: white; padding: 4px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: 600;">
                    Mode édition
                </div>
            </div>
            
            <!-- Section GPS pour Cahier -->
            <div class="gps-section">
                <h3 style="color: #1a472a; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-map-marker-alt"></i> Géolocalisation GPS (Activité)
                </h3>
                
                <div class="gps-coordinates">
                    <div class="gps-coordinate">
                        <label for="activityLatitude"><i class="fas fa-latitude"></i> Latitude</label>
                        <input type="text" id="activityLatitude" name="activityLatitude" readonly placeholder="Cliquez sur 'Obtenir GPS'">
                    </div>
                    
                    <div class="gps-coordinate">
                        <label for="activityLongitude"><i class="fas fa-longitude"></i> Longitude</label>
                        <input type="text" id="activityLongitude" name="activityLongitude" readonly placeholder="Cliquez sur 'Obtenir GPS'">
                    </div>
                    
                    <div class="gps-coordinate">
                        <label for="activityAccuracy"><i class="fas fa-crosshairs"></i> Précision</label>
                        <input type="text" id="activityAccuracy" name="activityAccuracy" readonly placeholder="Mètres">
                    </div>
                </div>
                
                <div class="gps-info" id="activityGpsStatus">
                    Statut GPS: <span class="gps-status inactive" id="activityGpsStatusText">Non actif</span>
                </div>
                
                <div style="margin-top: 15px; display: flex; gap: 10px; flex-wrap: wrap;">
                    <button type="button" id="activityGetGpsBtn" class="btn btn-gps">
                        <i class="fas fa-satellite"></i> Obtenir position GPS
                    </button>
                    
                    <button type="button" id="activityClearGpsBtn" class="btn" style="background-color: #757575; color: white;">
                        <i class="fas fa-trash-alt"></i> Effacer GPS
                    </button>
                    
                    <button type="button" id="activityViewMapBtn" class="btn btn-map">
                        <i class="fas fa-external-link-alt"></i> Voir sur carte
                    </button>
                </div>
            </div>
            
            <div class="activity-form" style="background-color: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 25px; border: 1px solid #e2e8f0;">
                <form id="activityForm">
                    <input type="hidden" id="editingActivityId" name="editingActivityId" value="">
                    <input type="hidden" id="activityGpsCoordinates" name="activityGpsCoordinates" value="">
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="personName"><i class="fas fa-user"></i> Nom étude</label>
                            <input type="text" id="personName" name="personName" placeholder="Nom de la personne" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="theme"><i class="fas fa-book-open"></i> Thème</label>
                            <input type="text" id="theme" name="theme" placeholder="Sujet abordé" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="nextVisitDate"><i class="fas fa-calendar-day"></i> Prochaine visite</label>
                            <input type="date" id="nextVisitDate" name="nextVisitDate" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="nextVisitTime"><i class="fas fa-clock"></i> Heure</label>
                            <input type="time" id="nextVisitTime" name="nextVisitTime" required>
                        </div>
                    </div>
                    
                    <div class="action-buttons">
                        <button type="submit" id="saveActivityBtn" class="btn btn-success">
                            <i class="fas fa-save"></i> Ajouter
                        </button>
                        
                        <button type="button" id="clearActivityForm" class="btn btn-primary">
                            <i class="fas fa-eraser"></i> Effacer
                        </button>
                        
                        <button type="button" id="cancelActivityEditBtn" class="btn" style="background-color: #757575; color: white; display: none;">
                            <i class="fas fa-times"></i> Annuler
                        </button>
                        
                        <button type="button" id="activityWhatsAppBtn" class="btn btn-whatsapp">
                            <i class="fab fa-whatsapp"></i> WhatsApp
                        </button>
                    </div>
                </form>
            </div>
            
            <h3 style="margin-bottom: 15px; color: #1a472a; font-size: 1.2rem;">
                <i class="fas fa-book"></i> Entrées du cahier
            </h3>
            
            <div id="activityList">
                <div class="empty-list">
                    <i class="fas fa-book-open"></i>
                    <h3>Cahier d'activité vide</h3>
                    <p>Ajoutez votre première entrée</p>
                </div>
            </div>
        </div>
        
        <!-- Onglet CARTE -->
        <div id="carte-tab" class="tab-content">
            <div class="form-header">
                <div class="form-title">
                    <i class="fas fa-map"></i>
                    <span id="carteFormTitle">Nouvelle fiche</span>
                </div>
                <div id="carteFormMode" class="form-mode-indicator" style="display: none; background-color: #f57c00; color: white; padding: 4px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: 600;">
                    Mode édition
                </div>
            </div>
            
            <!-- Section GPS pour Carte -->
            <div class="gps-section">
                <h3 style="color: #1a472a; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-map-marker-alt"></i> Géolocalisation GPS (Carte)
                </h3>
                
                <div class="gps-coordinates">
                    <div class="gps-coordinate">
                        <label for="carteLatitude"><i class="fas fa-latitude"></i> Latitude</label>
                        <input type="text" id="carteLatitude" name="carteLatitude" readonly placeholder="Cliquez sur 'Obtenir GPS'">
                    </div>
                    
                    <div class="gps-coordinate">
                        <label for="carteLongitude"><i class="fas fa-longitude"></i> Longitude</label>
                        <input type="text" id="carteLongitude" name="carteLongitude" readonly placeholder="Cliquez sur 'Obtenir GPS'">
                    </div>
                    
                    <div class="gps-coordinate">
                        <label for="carteAccuracy"><i class="fas fa-crosshairs"></i> Précision</label>
                        <input type="text" id="carteAccuracy" name="carteAccuracy" readonly placeholder="Mètres">
                    </div>
                </div>
                
                <div class="gps-info" id="carteGpsStatus">
                    Statut GPS: <span class="gps-status inactive" id="carteGpsStatusText">Non actif</span>
                </div>
                
                <div style="margin-top: 15px; display: flex; gap: 10px; flex-wrap: wrap;">
                    <button type="button" id="carteGetGpsBtn" class="btn btn-gps">
                        <i class="fas fa-satellite"></i> Obtenir position GPS
                    </button>
                    
                    <button type="button" id="carteClearGpsBtn" class="btn" style="background-color: #757575; color: white;">
                        <i class="fas fa-trash-alt"></i> Effacer GPS
                    </button>
                    
                    <button type="button" id="carteViewMapBtn" class="btn btn-map">
                        <i class="fas fa-external-link-alt"></i> Voir sur carte
                    </button>
                </div>
            </div>
            
            <div class="carte-form" style="background-color: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 25px; border: 1px solid #e2e8f0;">
                <form id="carteForm">
                    <input type="hidden" id="editingCarteId" name="editingCarteId" value="">
                    <input type="hidden" id="carteGpsCoordinates" name="carteGpsCoordinates" value="">
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="carteName"><i class="fas fa-user"></i> Nom</label>
                            <input type="text" id="carteName" name="carteName" placeholder="Nom complet" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="carteType"><i class="fas fa-user-tag"></i> Statut</label>
                            <select id="carteType" name="carteType" required>
                                <option value="">Sélectionnez</option>
                                <option value="Frère">Frère</option>
                                <option value="Sœur">Sœur</option>
                                <option value="Famille">Famille</option>
                                <option value="Ancien">Ancien</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="cartePhone"><i class="fas fa-phone"></i> Téléphone</label>
                            <input type="tel" id="cartePhone" name="cartePhone" placeholder="Numéro" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="carteCongregation"><i class="fas fa-church"></i> Congrégation</label>
                            <input type="text" id="carteCongregation" name="carteCongregation" placeholder="Congrégation" required>
                        </div>
                    </div>
                    
                    <div class="action-buttons">
                        <button type="submit" id="saveCarteBtn" class="btn btn-success">
                            <i class="fas fa-save"></i> Enregistrer
                        </button>
                        
                        <button type="button" id="carteWhatsAppBtn" class="btn btn-whatsapp">
                            <i class="fab fa-whatsapp"></i> WhatsApp
                        </button>
                        
                        <button type="button" id="cancelCarteEditBtn" class="btn" style="background-color: #757575; color: white; display: none;">
                            <i class="fas fa-times"></i> Annuler
                        </button>
                    </div>
                </form>
                
                <div class="map-buttons" style="display: flex; gap: 10px; margin-top: 20px; justify-content: center; flex-wrap: wrap;">
                    <button type="button" id="generateMapBtn" class="btn btn-map">
                        <i class="fas fa-map-marked-alt"></i> Carte
                    </button>
                    <button type="button" onclick="window.open('https://play.google.com/store/apps/details?id=com.vecturagames.android.app.gpxviewer', '_blank')" class="btn btn-gps">
                        <i class="fas fa-map-signs"></i> GPX
                    </button>
                </div>
            </div>
            
            <h3 style="margin-bottom: 15px; color: #1a472a; font-size: 1.2rem;">
                <i class="fas fa-users"></i> Liste des frères et sœurs
            </h3>
            
            <div id="carteList">
                <div class="empty-list">
                    <i class="fas fa-map"></i>
                    <h3>Aucune fiche</h3>
                    <p>Ajoutez votre première fiche</p>
                </div>
            </div>
        </div>
        
        <!-- Onglet RAPPORT D'ACTIVITÉ -->
        <div id="rapport-tab" class="tab-content">
            <div class="form-header">
                <div class="form-title">
                    <i class="fas fa-file-alt"></i>
                    <span id="rapportFormTitle">Rapport d'activité mensuel</span>
                </div>
            </div>
            
            <div class="rapport-form">
                <form id="rapportForm">
                    <!-- Section informations personnelles -->
                    <h3 class="section-title">
                        <i class="fas fa-user-circle"></i>
                        Informations personnelles
                    </h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="rapportNom"><i class="fas fa-user"></i> Nom</label>
                            <input type="text" id="rapportNom" name="rapportNom" placeholder="Votre nom" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="rapportPrenoms"><i class="fas fa-user-friends"></i> Prénoms</label>
                            <input type="text" id="rapportPrenoms" name="rapportPrenoms" placeholder="Vos prénoms" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="rapportCongregation"><i class="fas fa-church"></i> Congrégation</label>
                            <input type="text" id="rapportCongregation" name="rapportCongregation" placeholder="Votre congrégation" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="rapportVille"><i class="fas fa-city"></i> Ville</label>
                            <input type="text" id="rapportVille" name="rapportVille" placeholder="Votre ville" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="rapportGroupe"><i class="fas fa-users"></i> Groupe de prédication</label>
                            <select id="rapportGroupe" name="rapportGroupe" required>
                                <option value="">Sélectionnez votre groupe</option>
                                <option value="Groupe 1">Groupe 1</option>
                                <option value="Groupe 2">Groupe 2</option>
                                <option value="Groupe 3">Groupe 3</option>
                                <option value="Groupe 4">Groupe 4</option>
                                <option value="Groupe 5">Groupe 5</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="rapportMois"><i class="fas fa-calendar"></i> Mois de l'activité</label>
                            <input type="month" id="rapportMois" name="rapportMois" required>
                        </div>
                    </div>
                    
                    <!-- Section activités de prédication -->
                    <h3 class="section-title">
                        <i class="fas fa-bullhorn"></i>
                        Activités de prédication
                    </h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label><i class="fas fa-question-circle"></i> Avez-vous prêché ce mois ?</label>
                            <div class="radio-group">
                                <div class="radio-item">
                                    <input type="radio" id="precheOui" name="aPreche" value="oui" required>
                                    <label for="precheOui">Oui</label>
                                </div>
                                <div class="radio-item">
                                    <input type="radio" id="precheNon" name="aPreche" value="non">
                                    <label for="precheNon">Non</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label><i class="fas fa-tasks"></i> Types d'activités menées</label>
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="typePresentoir" name="typePresentoir" value="Présentoir">
                                    <label for="typePresentoir">Présentoir</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="typeFormelle" name="typeFormelle" value="Formelle">
                                    <label for="typeFormelle">Formelle</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="typeInformelle" name="typeInformelle" value="Informelle">
                                    <label for="typeInformelle">Informelle</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="typePublique" name="typePublique" value="Publique">
                                    <label for="typePublique">Publique</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="typeLieuPublic" name="typeLieuPublic" value="Visite de lieu public">
                                    <label for="typeLieuPublic">Visite de lieu public</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="typePrison" name="typePrison" value="Visite dans une prison">
                                    <label for="typePrison">Visite dans une prison</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="typeAdministratif" name="typeAdministratif" value="Lieux administratifs">
                                    <label for="typeAdministratif">Lieux administratifs</label>
                                </div>
                            </div>
                            <div class="form-help">Cochez toutes les activités que vous avez menées</div>
                        </div>
                    </div>
                    
                    <!-- Section nombre d'études -->
                    <h3 class="section-title">
                        <i class="fas fa-book-open"></i>
                        Études bibliques
                    </h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="etudesNouvelles"><i class="fas fa-star"></i> Nombre d'études nouvelles</label>
                            <input type="number" id="etudesNouvelles" name="etudesNouvelles" min="0" class="number-input" placeholder="0">
                        </div>
                        
                        <div class="form-group">
                            <label for="etudesAnciennes"><i class="fas fa-history"></i> Nombre d'études anciennes</label>
                            <input type="number" id="etudesAnciennes" name="etudesAnciennes" min="0" class="number-input" placeholder="0">
                        </div>
                    </div>
                    
                    <!-- Section nombre de fois par type d'activité -->
                    <h3 class="section-title">
                        <i class="fas fa-chart-line"></i>
                        Fréquence des activités
                    </h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="nbPresentoir"><i class="fas fa-people-carry"></i> Nombre de fois (Présentoir)</label>
                            <input type="number" id="nbPresentoir" name="nbPresentoir" min="0" class="number-input" placeholder="0">
                        </div>
                        
                        <div class="form-group">
                            <label for="nbFormelle"><i class="fas fa-user-tie"></i> Nombre de fois (Formelle)</label>
                            <input type="number" id="nbFormelle" name="nbFormelle" min="0" class="number-input" placeholder="0">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="nbInformelle"><i class="fas fa-comments"></i> Nombre de fois (Informelle)</label>
                            <input type="number" id="nbInformelle" name="nbInformelle" min="0" class="number-input" placeholder="0">
                        </div>
                        
                        <div class="form-group">
                            <label for="nbPublique"><i class="fas fa-bullhorn"></i> Nombre de fois (Publique)</label>
                            <input type="number" id="nbPublique" name="nbPublique" min="0" class="number-input" placeholder="0">
                        </div>
                    </div>
                    
                    <!-- Section observations -->
                    <h3 class="section-title">
                        <i class="fas fa-sticky-note"></i>
                        Observations supplémentaires
                    </h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="rapportObservations"><i class="fas fa-edit"></i> Remarques ou difficultés rencontrées</label>
                            <textarea id="rapportObservations" name="rapportObservations" rows="4" placeholder="Observations, difficultés, succès, témoignages..."></textarea>
                        </div>
                    </div>
                    
                    <!-- Section configuration WhatsApp -->
                    <h3 class="section-title">
                        <i class="fab fa-whatsapp"></i>
                        Envoi du rapport
                    </h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="whatsappNumber"><i class="fas fa-phone-alt"></i> Numéro WhatsApp de destination</label>
                            <input type="tel" id="whatsappNumber" name="whatsappNumber" value="+22892871605" required>
                            <div class="form-help">Vous pouvez modifier ce numéro selon votre groupe de prédication</div>
                        </div>
                    </div>
                    
                    <div class="action-buttons">
                        <button type="button" id="previsualiserRapport" class="btn btn-primary">
                            <i class="fas fa-eye"></i> Prévisualiser
                        </button>
                        
                        <button type="button" id="envoyerRapportWhatsApp" class="btn btn-whatsapp">
                            <i class="fab fa-whatsapp"></i> Envoyer par WhatsApp
                        </button>
                        
                        <button type="button" id="sauvegarderRapport" class="btn btn-success">
                            <i class="fas fa-save"></i> Sauvegarder
                        </button>
                        
                        <button type="reset" id="effacerRapport" class="btn" style="background-color: #757575; color: white;">
                            <i class="fas fa-eraser"></i> Effacer
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- Section prévisualisation -->
            <div id="previsualisationRapport" style="display: none; margin-top: 30px;">
                <h3 style="margin-bottom: 15px; color: #1a472a; font-size: 1.2rem;">
                    <i class="fas fa-eye"></i> Prévisualisation du rapport
                </h3>
                <div id="rapportPreview" style="background-color: white; padding: 20px; border-radius: 8px; border: 1px solid #e2e8f0;">
                    <!-- Le contenu de la prévisualisation sera injecté ici -->
                </div>
            </div>
        </div>
        
        <!-- NOUVEL ONGLET RÉUNION -->
        <div id="reunion-tab" class="tab-content">
            <div class="form-header">
                <div class="form-title">
                    <i class="fas fa-users"></i>
                    <span id="reunionFormTitle">Programme des Réunions</span>
                </div>
            </div>
            
            <div class="reunion-form">
                <form id="reunionForm">
                    <!-- Section Réunions principales -->
                    <div class="sous-section">
                        <h4><i class="fas fa-church"></i> Réunions Principales</h4>
                        
                        <div class="topic-row">
                            <label for="discoursBibliqueTheme">Discours Biblique :</label>
                            <input type="text" id="discoursBibliqueTheme" name="discoursBibliqueTheme" placeholder="Thème du discours" class="medium-input">
                            <div class="optional-note">(Optionnel)</div>
                        </div>
                        
                        <div class="topic-row">
                            <label for="tourDeGardeTheme">Tour de Garde :</label>
                            <input type="text" id="tourDeGardeTheme" name="tourDeGardeTheme" placeholder="Thème de la Tour de Garde" class="medium-input">
                            <div class="optional-note">(Optionnel)</div>
                        </div>
                    </div>
                    
                    <!-- Section Semaine Spatiale -->
                    <div class="sous-section">
                        <h4><i class="fas fa-calendar-week"></i> Semaine Spatiale</h4>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="semaineSpatialeDate">Date de la semaine :</label>
                                <input type="date" id="semaineSpatialeDate" name="semaineSpatialeDate">
                            </div>
                            
                            <div class="form-group">
                                <label for="surveillantVisite">Nom du surveillant en visite :</label>
                                <input type="text" id="surveillantVisite" name="surveillantVisite" placeholder="Nom du surveillant">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="debutReunion">Jour et heure du début :</label>
                                <div style="display: flex; gap: 10px;">
                                    <input type="date" id="debutReunionDate" name="debutReunionDate" style="flex: 1;">
                                    <input type="time" id="debutReunionHeure" name="debutReunionHeure" style="flex: 1;">
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="periodesRendezVous">Périodes, jours, heures et adresses :</label>
                                <textarea id="periodesRendezVous" name="periodesRendezVous" rows="4" placeholder="Ex: Lundi 14h - Salle du Royaume
Mardi 18h - Maison des frères X
Mercredi 10h - Place publique"></textarea>
                                <div class="optional-note">Détaillez les rendez-vous avec le surveillant en visite</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Section Assemblée -->
                    <div class="sous-section">
                        <h4><i class="fas fa-users"></i> Assemblée</h4>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="assembleeTheme">Thème de l'assemblée :</label>
                                <input type="text" id="assembleeTheme" name="assembleeTheme" placeholder="Thème de l'assemblée">
                            </div>
                            
                            <div class="form-group">
                                <label for="assembleeType">Type :</label>
                                <select id="assembleeType" name="assembleeType">
                                    <option value="">Sélectionnez</option>
                                    <option value="1 jour">1 jour</option>
                                    <option value="2 jours">2 jours</option>
                                    <option value="3 jours">3 jours</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="assembleeLieu">Lieu de l'assemblée :</label>
                                <input type="text" id="assembleeLieu" name="assembleeLieu" placeholder="Lieu de l'assemblée">
                            </div>
                            
                            <div class="form-group">
                                <label for="assembleeHeureDebut">Heure du début :</label>
                                <input type="time" id="assembleeHeureDebut" name="assembleeHeureDebut">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Section Étude de la semaine - Partie 1 -->
                    <div class="sous-section">
                        <h4><i class="fas fa-book-open"></i> Étude de la semaine - Partie 1</h4>
                        
                        <div class="topic-row">
                            <label for="joyauxParole">Joyaux de la Parole :</label>
                            <input type="text" id="joyauxParole" name="joyauxParole" placeholder="Élève(s) et sujet" class="medium-input">
                        </div>
                        
                        <div class="topic-row">
                            <label for="perlesSpirituelles">Perles Spirituelles :</label>
                            <input type="text" id="perlesSpirituelles" name="perlesSpirituelles" placeholder="Élève(s) et sujet" class="medium-input">
                        </div>
                        
                        <div class="topic-row">
                            <label for="lectureBible">Lecture de la Bible :</label>
                            <input type="text" id="lectureBible" name="lectureBible" placeholder="Élève(s) et sujet" class="medium-input">
                        </div>
                        
                        <div class="topic-row">
                            <label for="appliqueMinistry">Applique-toi au ministère :</label>
                            <input type="text" id="appliqueMinistry" name="appliqueMinistry" placeholder="Élève(s) et sujet" class="medium-input">
                        </div>
                        
                        <div class="topic-row">
                            <label for="sujet4">Sujet 4 :</label>
                            <input type="text" id="sujet4" name="sujet4" placeholder="Élève(s) et sujet" class="medium-input">
                        </div>
                        
                        <div class="topic-row">
                            <label for="sujet5">Sujet 5 :</label>
                            <input type="text" id="sujet5" name="sujet5" placeholder="Élève(s) et sujet" class="medium-input">
                        </div>
                        
                        <div class="topic-row">
                            <label for="sujet6">Sujet 6 :</label>
                            <input type="text" id="sujet6" name="sujet6" placeholder="Élève(s) et sujet" class="medium-input">
                        </div>
                    </div>
                    
                    <!-- Section Étude de la semaine - Partie 2 -->
                    <div class="sous-section">
                        <h4><i class="fas fa-heart"></i> Étude de la semaine - Partie 2</h4>
                        
                        <div class="topic-row">
                            <label for="vieChretienne">Vie Chrétienne :</label>
                            <input type="text" id="vieChretienne" name="vieChretienne" placeholder="Élève(s) et sujet" class="medium-input">
                        </div>
                        
                        <div class="topic-row">
                            <label for="etudeBibliqueAssemblee">Étude Biblique de l'assemblée :</label>
                            <input type="text" id="etudeBibliqueAssemblee" name="etudeBibliqueAssemblee" placeholder="Thème et participants" class="medium-input">
                        </div>
                    </div>
                    
                    <!-- Section Envoi WhatsApp -->
                    <div class="sous-section">
                        <h4><i class="fab fa-whatsapp"></i> Envoi au Groupe WhatsApp</h4>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="whatsappGroupLink">Lien du groupe WhatsApp :</label>
                                <div class="link-input-group">
                                    <input type="text" id="whatsappGroupLink" name="whatsappGroupLink" value="https://chat.whatsapp.com/" placeholder="Coller le lien du groupe WhatsApp">
                                    <button type="button" id="testWhatsappLink" class="test-whatsapp-btn">
                                        <i class="fas fa-external-link-alt"></i> Tester
                                    </button>
                                </div>
                                <div class="form-help">Vous pouvez modifier ce lien selon votre groupe</div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="messageComplementaire">Message complémentaire :</label>
                                <textarea id="messageComplementaire" name="messageComplementaire" rows="3" placeholder="Ajoutez un message personnel ou des informations supplémentaires..."></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <div class="action-buttons">
                        <button type="button" id="previsualiserReunion" class="btn btn-primary">
                            <i class="fas fa-eye"></i> Prévisualiser
                        </button>
                        
                        <button type="button" id="envoyerReunionWhatsApp" class="btn btn-whatsapp">
                            <i class="fab fa-whatsapp"></i> Envoyer au Groupe
                        </button>
                        
                        <button type="button" id="sauvegarderReunion" class="btn btn-success">
                            <i class="fas fa-save"></i> Sauvegarder
                        </button>
                        
                        <button type="reset" id="effacerReunion" class="btn" style="background-color: #757575; color: white;">
                            <i class="fas fa-eraser"></i> Effacer
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- Section prévisualisation -->
            <div id="previsualisationReunion" style="display: none; margin-top: 30px;">
                <h3 style="margin-bottom: 15px; color: #1a472a; font-size: 1.2rem;">
                    <i class="fas fa-eye"></i> Prévisualisation du Programme
                </h3>
                <div id="reunionPreview" style="background-color: white; padding: 20px; border-radius: 8px; border: 1px solid #e2e8f0;">
                    <!-- Le contenu de la prévisualisation sera injecté ici -->
                </div>
            </div>
        </div>
        
        <!-- Onglet Liste -->
        <div id="liste-tab" class="tab-content">
            <div class="list-content" style="padding: 20px;">
                <h2 style="margin-bottom: 15px; color: #1a472a; font-size: 1.3rem;">Liste des prédications</h2>
                <div id="preachingList">
                    <div class="empty-list">
                        <i class="fas fa-calendar-times"></i>
                        <h3>Aucune prédication</h3>
                        <p>Ajoutez une prédication</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Onglet Statistiques -->
        <div id="statistiques-tab" class="tab-content">
            <div class="list-content" style="padding: 20px;">
                <h2 style="margin-bottom: 15px; color: #1a472a; font-size: 1.3rem;">Statistiques</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                        <h3 style="color: #1a472a; font-size: 1rem;">Prédications</h3>
                        <div id="totalPreachings" class="stat-value">0</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <h3 style="color: #1a472a; font-size: 1rem;">Groupes</h3>
                        <div id="activeGroups" class="stat-value">0</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-map-marker-alt"></i>
                        </div>
                        <h3 style="color: #1a472a; font-size: 1rem;">Lieux</h3>
                        <div id="differentLocations" class="stat-value">0</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-book"></i>
                        </div>
                        <h3 style="color: #1a472a; font-size: 1rem;">Études</h3>
                        <div id="totalActivities" class="stat-value">0</div>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Application "Prêchons" - Suivi des activités de prédication</p>
            <p>Numéro WhatsApp : <strong>+228 92871605</strong></p>
            <p>Recherche : <strong>https://www.ia-elian.com/</strong></p>
        </footer>
    </div>
    
    <div id="notification" class="notification"></div>
    
    <!-- Inputs fichiers cachés -->
    <input type="file" id="fileInput" accept=".json" style="display: none;">
    <input type="file" id="activityFileInput" accept=".json" style="display: none;">
    <input type="file" id="carteFileInput" accept=".json" style="display: none;">
    
    <script>
        // Initialisation des variables principales
        const authContainer = document.getElementById('authContainer');
        const mainContainer = document.getElementById('mainContainer');
        const authForm = document.getElementById('authForm');
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');
        const authError = document.getElementById('authError');
        const currentUser = document.getElementById('currentUser');
        const userInfo = document.getElementById('userInfo');
        const logoutBtn = document.getElementById('logoutBtn');
        const accessDenied = document.getElementById('accessDenied');
        const rdvContent = document.getElementById('rdvContent');
        const rdvTab = document.getElementById('rdvTab');
        const loginFromDeniedBtn = document.getElementById('loginFromDeniedBtn');
        
        // Variables d'authentification
        let isAuthenticated = false;
        let authenticatedUser = '';
        const VALID_USERNAME = "KARA NORD";
        const VALID_PASSWORD = "KARA1@";
        
        // Variables de données
        let preachings = JSON.parse(localStorage.getItem('preachings')) || [];
        let activities = JSON.parse(localStorage.getItem('activities')) || [];
        let cartes = JSON.parse(localStorage.getItem('cartes')) || [];
        let rapports = JSON.parse(localStorage.getItem('rapports')) || [];
        let reunions = JSON.parse(localStorage.getItem('reunions')) || [];
        
        // Variables GPS
        let currentPosition = null;
        let trajectoryPoints = [];
        let gpsWatchId = null;
        
        // Initialisation au chargement
        document.addEventListener('DOMContentLoaded', function() {
            checkAuthentication();
            
            // Gestion de l'authentification
            authForm.addEventListener('submit', function(event) {
                event.preventDefault();
                
                const username = usernameInput.value.trim();
                const password = passwordInput.value;
                
                if (username === VALID_USERNAME && password === VALID_PASSWORD) {
                    isAuthenticated = true;
                    authenticatedUser = username;
                    
                    localStorage.setItem('prechons_auth', JSON.stringify({
                        authenticated: true,
                        user: username,
                        timestamp: new Date().toISOString()
                    }));
                    
                    showMainInterface();
                    showNotification(`Bienvenue ${authenticatedUser} !`, "success");
                } else {
                    authError.style.display = 'block';
                    passwordInput.value = '';
                    passwordInput.focus();
                    authContainer.classList.add('shake');
                    setTimeout(() => authContainer.classList.remove('shake'), 500);
                }
            });
            
            // Initialiser l'application si déjà authentifié
            if (isAuthenticated) {
                initApplication();
            }
        });
        
        // Vérifier l'authentification
        function checkAuthentication() {
            const savedAuth = localStorage.getItem('prechons_auth');
            if (savedAuth) {
                try {
                    const authData = JSON.parse(savedAuth);
                    if (authData.authenticated && authData.user === VALID_USERNAME) {
                        isAuthenticated = true;
                        authenticatedUser = authData.user;
                        showMainInterface();
                        return;
                    }
                } catch (e) {
                    console.error("Erreur d'authentification:", e);
                }
            }
            showAuthInterface();
        }
        
        // Afficher l'interface d'authentification
        function showAuthInterface() {
            authContainer.style.display = 'block';
            mainContainer.style.display = 'none';
            authForm.reset();
            authError.style.display = 'none';
            setTimeout(() => usernameInput.focus(), 100);
        }
        
        // Afficher l'interface principale
        function showMainInterface() {
            authContainer.style.display = 'none';
            mainContainer.style.display = 'block';
            currentUser.textContent = authenticatedUser;
            userInfo.style.display = 'flex';
            updateRdvTabDisplay();
            initApplication();
        }
        
        // Mettre à jour l'affichage de l'onglet RDV
        function updateRdvTabDisplay() {
            if (isAuthenticated) {
                accessDenied.style.display = 'none';
                rdvContent.style.display = 'block';
                rdvTab.classList.remove('locked-tab');
            } else {
                accessDenied.style.display = 'block';
                rdvContent.style.display = 'none';
                rdvTab.classList.add('locked-tab');
            }
        }
        
        // Initialiser l'application
        function initApplication() {
            // Gestion de la déconnexion
            if (logoutBtn) {
                logoutBtn.addEventListener('click', function() {
                    if (confirm("Voulez-vous vraiment vous déconnecter ?")) {
                        localStorage.removeItem('prechons_auth');
                        isAuthenticated = false;
                        authenticatedUser = '';
                        showAuthInterface();
                        showNotification("Déconnecté avec succès", "info");
                    }
                });
            }
            
            // Bouton de connexion depuis l'accès refusé
            if (loginFromDeniedBtn) {
                loginFromDeniedBtn.addEventListener('click', showAuthInterface);
            }
            
            // Initialiser les données
            updatePreachingList();
            updateActivityList();
            updateCarteList();
            updateStatistics();
            
            // Définir les dates par défaut
            const today = new Date().toISOString().split('T')[0];
            if (document.getElementById('date')) {
                document.getElementById('date').value = today;
            }
            
            // Définir le mois courant par défaut pour le rapport
            const currentMonth = new Date().toISOString().slice(0, 7);
            if (document.getElementById('rapportMois')) {
                document.getElementById('rapportMois').value = currentMonth;
            }
            
            // Définir la date par défaut pour la semaine spatiale (prochaine semaine)
            const nextWeek = new Date();
            nextWeek.setDate(nextWeek.getDate() + 7);
            if (document.getElementById('semaineSpatialeDate')) {
                document.getElementById('semaineSpatialeDate').value = nextWeek.toISOString().split('T')[0];
            }
            
            if (document.getElementById('debutReunionDate')) {
                document.getElementById('debutReunionDate').value = nextWeek.toISOString().split('T')[0];
                document.getElementById('debutReunionHeure').value = '19:00';
            }
            
            if (document.getElementById('nextVisitDate')) {
                document.getElementById('nextVisitDate').value = nextWeek.toISOString().split('T')[0];
                document.getElementById('nextVisitTime').value = '10:00';
            }
            
            // Gestion des onglets
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.getAttribute('data-tab');
                    
                    // Vérifier l'accès à l'onglet RDV
                    if (tabId === 'rdv' && !isAuthenticated) {
                        updateRdvTabDisplay();
                        return;
                    }
                    
                    // Activer l'onglet sélectionné
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                    
                    tab.classList.add('active');
                    const tabContent = document.getElementById(`${tabId}-tab`);
                    if (tabContent) {
                        tabContent.classList.add('active');
                    }
                });
            });
            
            // ===========================================
            // FONCTIONS GPS
            // ===========================================
            
            // Fonction pour obtenir la position GPS
            function getCurrentPosition(onSuccess, onError = null) {
                if (!navigator.geolocation) {
                    showNotification("La géolocalisation n'est pas supportée par votre navigateur", "error");
                    if (onError) onError();
                    return;
                }
                
                showNotification("Obtention de la position GPS...", "info");
                
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        currentPosition = position;
                        onSuccess(position);
                    },
                    function(error) {
                        let errorMessage = "Erreur lors de l'obtention de la position GPS: ";
                        switch(error.code) {
                            case error.PERMISSION_DENIED:
                                errorMessage += "Permission refusée";
                                break;
                            case error.POSITION_UNAVAILABLE:
                                errorMessage += "Position indisponible";
                                break;
                            case error.TIMEOUT:
                                errorMessage += "Temps d'attente dépassé";
                                break;
                            default:
                                errorMessage += "Erreur inconnue";
                        }
                        showNotification(errorMessage, "error");
                        if (onError) onError();
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 0
                    }
                );
            }
            
            // Fonction pour démarrer le suivi de trajectoire
            function startTrajectoryTracking() {
                if (gpsWatchId) {
                    return; // Déjà en cours
                }
                
                if (!navigator.geolocation) {
                    showNotification("La géolocalisation n'est pas supportée par votre navigateur", "error");
                    return;
                }
                
                showNotification("Démarrage du suivi de trajectoire...", "info");
                
                gpsWatchId = navigator.geolocation.watchPosition(
                    function(position) {
                        // Ajouter le point à la trajectoire
                        const point = {
                            lat: position.coords.latitude,
                            lon: position.coords.longitude,
                            accuracy: position.coords.accuracy,
                            timestamp: new Date().toISOString(),
                            time: new Date().toLocaleTimeString()
                        };
                        
                        trajectoryPoints.push(point);
                        
                        // Mettre à jour l'affichage de la trajectoire
                        updateTrajectoryDisplay();
                        
                        // Afficher la section trajectoire si ce n'est pas déjà fait
                        const trajectorySection = document.getElementById('trajectorySection');
                        if (trajectorySection) {
                            trajectorySection.style.display = 'block';
                        }
                    },
                    function(error) {
                        showNotification("Erreur lors du suivi GPS", "error");
                    },
                    {
                        enableHighAccuracy: true,
                        maximumAge: 0
                    }
                );
            }
            
            // Fonction pour arrêter le suivi de trajectoire
            function stopTrajectoryTracking() {
                if (gpsWatchId) {
                    navigator.geolocation.clearWatch(gpsWatchId);
                    gpsWatchId = null;
                    showNotification("Suivi de trajectoire arrêté", "info");
                }
            }
            
            // Fonction pour mettre à jour l'affichage de la trajectoire
            function updateTrajectoryDisplay() {
                const trajectoryList = document.getElementById('trajectoryList');
                if (!trajectoryList) return;
                
                if (trajectoryPoints.length === 0) {
                    trajectoryList.innerHTML = '<div class="trajectory-point">Aucun point enregistré</div>';
                    return;
                }
                
                // Afficher les 10 derniers points
                const recentPoints = trajectoryPoints.slice(-10);
                trajectoryList.innerHTML = recentPoints.map((point, index) => `
                    <div class="trajectory-point">
                        <div style="display: flex; justify-content: space-between;">
                            <div>
                                <strong>Point ${trajectoryPoints.length - recentPoints.length + index + 1}</strong>
                            </div>
                            <div style="color: #666; font-size: 0.8rem;">
                                ${point.time}
                            </div>
                        </div>
                        <div style="font-size: 0.85rem;">
                            Lat: ${point.lat.toFixed(6)}, Lon: ${point.lon.toFixed(6)}
                        </div>
                        <div style="font-size: 0.8rem; color: #888;">
                            Précision: ±${Math.round(point.accuracy)}m
                        </div>
                    </div>
                `).join('');
                
                // Faire défiler vers le bas
                trajectoryList.scrollTop = trajectoryList.scrollHeight;
            }
            
            // Fonction pour générer un lien Google Maps
            function generateGoogleMapsLink(latitude, longitude) {
                return `https://www.google.com/maps?q=${latitude},${longitude}`;
            }
            
            // Fonction pour générer un lien de suivi de trajectoire
            function generateTrajectoryLink() {
                if (trajectoryPoints.length < 2) {
                    return null;
                }
                
                // Créer un lien pour visualiser la trajectoire
                // Note: Pour une vraie application, vous pourriez utiliser l'API Google Maps
                // ou créer un fichier GPX téléchargeable
                const firstPoint = trajectoryPoints[0];
                const lastPoint = trajectoryPoints[trajectoryPoints.length - 1];
                
                return `https://www.google.com/maps/dir/${firstPoint.lat},${firstPoint.lon}/${lastPoint.lat},${lastPoint.lon}`;
            }
            
            // ===========================================
            // GESTION GPS POUR L'ONGLET RDV
            // ===========================================
            
            // Bouton pour obtenir la position GPS (RDV)
            const getGpsBtn = document.getElementById('getGpsBtn');
            if (getGpsBtn) {
                getGpsBtn.addEventListener('click', function() {
                    getCurrentPosition(function(position) {
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;
                        const accuracy = position.coords.accuracy;
                        
                        // Mettre à jour les champs
                        document.getElementById('latitude').value = lat.toFixed(6);
                        document.getElementById('longitude').value = lon.toFixed(6);
                        document.getElementById('accuracy').value = `${Math.round(accuracy)} mètres`;
                        
                        // Mettre à jour le statut
                        const gpsStatusText = document.getElementById('gpsStatusText');
                        if (gpsStatusText) {
                            gpsStatusText.textContent = "Actif";
                            gpsStatusText.className = "gps-status active";
                        }
                        
                        // Mettre à jour le champ caché
                        document.getElementById('gpsCoordinates').value = JSON.stringify({
                            latitude: lat,
                            longitude: lon,
                            accuracy: accuracy,
                            timestamp: new Date().toISOString()
                        });
                        
                        // Démarrer le suivi de trajectoire
                        startTrajectoryTracking();
                        
                        showNotification("Position GPS obtenue avec succès", "success");
                    });
                });
            }
            
            // Bouton pour effacer les données GPS (RDV)
            const clearGpsBtn = document.getElementById('clearGpsBtn');
            if (clearGpsBtn) {
                clearGpsBtn.addEventListener('click', function() {
                    document.getElementById('latitude').value = '';
                    document.getElementById('longitude').value = '';
                    document.getElementById('accuracy').value = '';
                    document.getElementById('gpsCoordinates').value = '';
                    
                    const gpsStatusText = document.getElementById('gpsStatusText');
                    if (gpsStatusText) {
                        gpsStatusText.textContent = "Non actif";
                        gpsStatusText.className = "gps-status inactive";
                    }
                    
                    // Arrêter le suivi de trajectoire
                    stopTrajectoryTracking();
                    
                    // Effacer la trajectoire
                    trajectoryPoints = [];
                    updateTrajectoryDisplay();
                    
                    const trajectorySection = document.getElementById('trajectorySection');
                    if (trajectorySection) {
                        trajectorySection.style.display = 'none';
                    }
                    
                    showNotification("Données GPS effacées", "info");
                });
            }
            
            // Bouton pour voir sur la carte (RDV)
            const viewMapBtn = document.getElementById('viewMapBtn');
            if (viewMapBtn) {
                viewMapBtn.addEventListener('click', function() {
                    const lat = document.getElementById('latitude').value;
                    const lon = document.getElementById('longitude').value;
                    
                    if (!lat || !lon) {
                        showNotification("Aucune position GPS disponible", "warning");
                        return;
                    }
                    
                    const mapsLink = generateGoogleMapsLink(lat, lon);
                    window.open(mapsLink, '_blank');
                });
            }
            
            // Bouton pour effacer la trajectoire (RDV)
            const clearTrajectoryBtn = document.getElementById('clearTrajectoryBtn');
            if (clearTrajectoryBtn) {
                clearTrajectoryBtn.addEventListener('click', function() {
                    trajectoryPoints = [];
                    updateTrajectoryDisplay();
                    showNotification("Trajectoire effacée", "info");
                });
            }
            
            // ===========================================
            // GESTION GPS POUR L'ONGLET CAHIER
            // ===========================================
            
            // Bouton pour obtenir la position GPS (Cahier)
            const activityGetGpsBtn = document.getElementById('activityGetGpsBtn');
            if (activityGetGpsBtn) {
                activityGetGpsBtn.addEventListener('click', function() {
                    getCurrentPosition(function(position) {
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;
                        const accuracy = position.coords.accuracy;
                        
                        // Mettre à jour les champs
                        document.getElementById('activityLatitude').value = lat.toFixed(6);
                        document.getElementById('activityLongitude').value = lon.toFixed(6);
                        document.getElementById('activityAccuracy').value = `${Math.round(accuracy)} mètres`;
                        
                        // Mettre à jour le statut
                        const gpsStatusText = document.getElementById('activityGpsStatusText');
                        if (gpsStatusText) {
                            gpsStatusText.textContent = "Actif";
                            gpsStatusText.className = "gps-status active";
                        }
                        
                        // Mettre à jour le champ caché
                        document.getElementById('activityGpsCoordinates').value = JSON.stringify({
                            latitude: lat,
                            longitude: lon,
                            accuracy: accuracy,
                            timestamp: new Date().toISOString()
                        });
                        
                        showNotification("Position GPS obtenue avec succès (Activité)", "success");
                    });
                });
            }
            
            // Bouton pour effacer les données GPS (Cahier)
            const activityClearGpsBtn = document.getElementById('activityClearGpsBtn');
            if (activityClearGpsBtn) {
                activityClearGpsBtn.addEventListener('click', function() {
                    document.getElementById('activityLatitude').value = '';
                    document.getElementById('activityLongitude').value = '';
                    document.getElementById('activityAccuracy').value = '';
                    document.getElementById('activityGpsCoordinates').value = '';
                    
                    const gpsStatusText = document.getElementById('activityGpsStatusText');
                    if (gpsStatusText) {
                        gpsStatusText.textContent = "Non actif";
                        gpsStatusText.className = "gps-status inactive";
                    }
                    
                    showNotification("Données GPS effacées (Activité)", "info");
                });
            }
            
            // Bouton pour voir sur la carte (Cahier)
            const activityViewMapBtn = document.getElementById('activityViewMapBtn');
            if (activityViewMapBtn) {
                activityViewMapBtn.addEventListener('click', function() {
                    const lat = document.getElementById('activityLatitude').value;
                    const lon = document.getElementById('activityLongitude').value;
                    
                    if (!lat || !lon) {
                        showNotification("Aucune position GPS disponible", "warning");
                        return;
                    }
                    
                    const mapsLink = generateGoogleMapsLink(lat, lon);
                    window.open(mapsLink, '_blank');
                });
            }
            
            // ===========================================
            // GESTION GPS POUR L'ONGLET CARTE
            // ===========================================
            
            // Bouton pour obtenir la position GPS (Carte)
            const carteGetGpsBtn = document.getElementById('carteGetGpsBtn');
            if (carteGetGpsBtn) {
                carteGetGpsBtn.addEventListener('click', function() {
                    getCurrentPosition(function(position) {
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;
                        const accuracy = position.coords.accuracy;
                        
                        // Mettre à jour les champs
                        document.getElementById('carteLatitude').value = lat.toFixed(6);
                        document.getElementById('carteLongitude').value = lon.toFixed(6);
                        document.getElementById('carteAccuracy').value = `${Math.round(accuracy)} mètres`;
                        
                        // Mettre à jour le statut
                        const gpsStatusText = document.getElementById('carteGpsStatusText');
                        if (gpsStatusText) {
                            gpsStatusText.textContent = "Actif";
                            gpsStatusText.className = "gps-status active";
                        }
                        
                        // Mettre à jour le champ caché
                        document.getElementById('carteGpsCoordinates').value = JSON.stringify({
                            latitude: lat,
                            longitude: lon,
                            accuracy: accuracy,
                            timestamp: new Date().toISOString()
                        });
                        
                        showNotification("Position GPS obtenue avec succès (Carte)", "success");
                    });
                });
            }
            
            // Bouton pour effacer les données GPS (Carte)
            const carteClearGpsBtn = document.getElementById('carteClearGpsBtn');
            if (carteClearGpsBtn) {
                carteClearGpsBtn.addEventListener('click', function() {
                    document.getElementById('carteLatitude').value = '';
                    document.getElementById('carteLongitude').value = '';
                    document.getElementById('carteAccuracy').value = '';
                    document.getElementById('carteGpsCoordinates').value = '';
                    
                    const gpsStatusText = document.getElementById('carteGpsStatusText');
                    if (gpsStatusText) {
                        gpsStatusText.textContent = "Non actif";
                        gpsStatusText.className = "gps-status inactive";
                    }
                    
                    showNotification("Données GPS effacées (Carte)", "info");
                });
            }
            
            // Bouton pour voir sur la carte (Carte)
            const carteViewMapBtn = document.getElementById('carteViewMapBtn');
            if (carteViewMapBtn) {
                carteViewMapBtn.addEventListener('click', function() {
                    const lat = document.getElementById('carteLatitude').value;
                    const lon = document.getElementById('carteLongitude').value;
                    
                    if (!lat || !lon) {
                        showNotification("Aucune position GPS disponible", "warning");
                        return;
                    }
                    
                    const mapsLink = generateGoogleMapsLink(lat, lon);
                    window.open(mapsLink, '_blank');
                });
            }
            
            // Gestion du formulaire de prédication
            const preachingForm = document.getElementById('preachingForm');
            if (preachingForm) {
                preachingForm.addEventListener('submit', function(event) {
                    event.preventDefault();
                    
                    if (!isAuthenticated) {
                        showNotification("Veuillez vous connecter", "warning");
                        return;
                    }
                    
                    const formData = new FormData(this);
                    const data = Object.fromEntries(formData.entries());
                    data.timestamp = new Date().toISOString();
                    data.id = Date.now();
                    
                    // Ajouter les données GPS si disponibles
                    const gpsCoordinates = document.getElementById('gpsCoordinates').value;
                    if (gpsCoordinates) {
                        try {
                            data.gps = JSON.parse(gpsCoordinates);
                        } catch (e) {
                            console.error("Erreur d'analyse des coordonnées GPS:", e);
                        }
                    }
                    
                    // Ajouter la trajectoire si disponible
                    if (trajectoryPoints.length > 0) {
                        data.trajectory = trajectoryPoints;
                        document.getElementById('gpsTrajectory').value = JSON.stringify(trajectoryPoints);
                    }
                    
                    preachings.push(data);
                    localStorage.setItem('preachings', JSON.stringify(preachings));
                    
                    updatePreachingList();
                    updateStatistics();
                    this.reset();
                    if (document.getElementById('date')) {
                        document.getElementById('date').value = today;
                    }
                    
                    // Réinitialiser les champs GPS
                    document.getElementById('latitude').value = '';
                    document.getElementById('longitude').value = '';
                    document.getElementById('accuracy').value = '';
                    document.getElementById('gpsCoordinates').value = '';
                    document.getElementById('gpsTrajectory').value = '';
                    
                    // Réinitialiser le statut GPS
                    const gpsStatusText = document.getElementById('gpsStatusText');
                    if (gpsStatusText) {
                        gpsStatusText.textContent = "Non actif";
                        gpsStatusText.className = "gps-status inactive";
                    }
                    
                    // Arrêter le suivi et effacer la trajectoire
                    stopTrajectoryTracking();
                    trajectoryPoints = [];
                    updateTrajectoryDisplay();
                    
                    const trajectorySection = document.getElementById('trajectorySection');
                    if (trajectorySection) {
                        trajectorySection.style.display = 'none';
                    }
                    
                    showNotification("Prédication enregistrée avec données GPS!", "success");
                });
            }
            
            // Gestion du formulaire d'activité
            const activityForm = document.getElementById('activityForm');
            if (activityForm) {
                activityForm.addEventListener('submit', function(event) {
                    event.preventDefault();
                    
                    const formData = new FormData(this);
                    const data = Object.fromEntries(formData.entries());
                    data.timestamp = new Date().toISOString();
                    data.id = Date.now();
                    
                    // Ajouter les données GPS si disponibles
                    const gpsCoordinates = document.getElementById('activityGpsCoordinates').value;
                    if (gpsCoordinates) {
                        try {
                            data.gps = JSON.parse(gpsCoordinates);
                        } catch (e) {
                            console.error("Erreur d'analyse des coordonnées GPS:", e);
                        }
                    }
                    
                    activities.push(data);
                    localStorage.setItem('activities', JSON.stringify(activities));
                    
                    updateActivityList();
                    updateStatistics();
                    this.reset();
                    
                    if (document.getElementById('nextVisitDate')) {
                        const nextWeek = new Date();
                        nextWeek.setDate(nextWeek.getDate() + 7);
                        document.getElementById('nextVisitDate').value = nextWeek.toISOString().split('T')[0];
                        document.getElementById('nextVisitTime').value = '10:00';
                    }
                    
                    // Réinitialiser les champs GPS
                    document.getElementById('activityLatitude').value = '';
                    document.getElementById('activityLongitude').value = '';
                    document.getElementById('activityAccuracy').value = '';
                    document.getElementById('activityGpsCoordinates').value = '';
                    
                    // Réinitialiser le statut GPS
                    const gpsStatusText = document.getElementById('activityGpsStatusText');
                    if (gpsStatusText) {
                        gpsStatusText.textContent = "Non actif";
                        gpsStatusText.className = "gps-status inactive";
                    }
                    
                    showNotification("Activité enregistrée avec données GPS!", "success");
                });
            }
            
            // Gestion du formulaire de carte
            const carteForm = document.getElementById('carteForm');
            if (carteForm) {
                carteForm.addEventListener('submit', function(event) {
                    event.preventDefault();
                    
                    const formData = new FormData(this);
                    const data = Object.fromEntries(formData.entries());
                    data.timestamp = new Date().toISOString();
                    data.id = Date.now();
                    
                    // Ajouter les données GPS si disponibles
                    const gpsCoordinates = document.getElementById('carteGpsCoordinates').value;
                    if (gpsCoordinates) {
                        try {
                            data.gps = JSON.parse(gpsCoordinates);
                        } catch (e) {
                            console.error("Erreur d'analyse des coordonnées GPS:", e);
                        }
                    }
                    
                    cartes.push(data);
                    localStorage.setItem('cartes', JSON.stringify(cartes));
                    
                    updateCarteList();
                    this.reset();
                    
                    // Réinitialiser les champs GPS
                    document.getElementById('carteLatitude').value = '';
                    document.getElementById('carteLongitude').value = '';
                    document.getElementById('carteAccuracy').value = '';
                    document.getElementById('carteGpsCoordinates').value = '';
                    
                    // Réinitialiser le statut GPS
                    const gpsStatusText = document.getElementById('carteGpsStatusText');
                    if (gpsStatusText) {
                        gpsStatusText.textContent = "Non actif";
                        gpsStatusText.className = "gps-status inactive";
                    }
                    
                    showNotification("Fiche enregistrée avec données GPS!", "success");
                });
            }
            
            // Bouton WhatsApp pour les cartes
            const carteWhatsAppBtn = document.getElementById('carteWhatsAppBtn');
            if (carteWhatsAppBtn) {
                carteWhatsAppBtn.addEventListener('click', function() {
                    const form = document.getElementById('carteForm');
                    if (!form) return;
                    
                    const formData = new FormData(form);
                    const data = Object.fromEntries(formData.entries());
                    
                    if (!data.carteName || !data.carteType || !data.cartePhone) {
                        showNotification("Remplissez les champs obligatoires", "warning");
                        return;
                    }
                    
                    let message = `*NOUVELLE FICHE*\n\n`;
                    message += `👤 *Nom:* ${data.carteName}\n`;
                    message += `🏷️ *Statut:* ${data.carteType}\n`;
                    message += `📞 *Téléphone:* ${data.cartePhone}\n`;
                    
                    if (data.carteCongregation) {
                        message += `⛪ *Congrégation:* ${data.carteCongregation}\n`;
                    }
                    
                    // Ajouter les coordonnées GPS si disponibles
                    const lat = document.getElementById('carteLatitude').value;
                    const lon = document.getElementById('carteLongitude').value;
                    if (lat && lon) {
                        message += `📍 *Coordonnées GPS:* ${lat}, ${lon}\n`;
                        message += `🗺️ *Lien carte:* ${generateGoogleMapsLink(lat, lon)}\n`;
                    }
                    
                    const encodedMessage = encodeURIComponent(message);
                    const phoneNumber = "+22892871605";
                    const whatsappUrl = `https://wa.me/${phoneNumber}?text=${encodedMessage}`;
                    
                    window.open(whatsappUrl, '_blank');
                    showNotification("Message préparé pour WhatsApp avec GPS", "success");
                });
            }
            
            // Bouton WhatsApp pour les activités
            const activityWhatsAppBtn = document.getElementById('activityWhatsAppBtn');
            if (activityWhatsAppBtn) {
                activityWhatsAppBtn.addEventListener('click', function() {
                    const form = document.getElementById('activityForm');
                    if (!form) return;
                    
                    const formData = new FormData(form);
                    const data = Object.fromEntries(formData.entries());
                    
                    if (!data.personName || !data.theme || !data.nextVisitDate) {
                        showNotification("Remplissez les champs obligatoires", "warning");
                        return;
                    }
                    
                    let message = `*NOUVELLE ACTIVITÉ*\n\n`;
                    message += `👤 *Nom étude:* ${data.personName}\n`;
                    message += `📚 *Thème:* ${data.theme}\n`;
                    message += `📅 *Prochaine visite:* ${data.nextVisitDate} à ${data.nextVisitTime || 'Non spécifié'}\n`;
                    
                    // Ajouter les coordonnées GPS si disponibles
                    const lat = document.getElementById('activityLatitude').value;
                    const lon = document.getElementById('activityLongitude').value;
                    if (lat && lon) {
                        message += `📍 *Coordonnées GPS:* ${lat}, ${lon}\n`;
                        message += `🗺️ *Lien carte:* ${generateGoogleMapsLink(lat, lon)}\n`;
                    }
                    
                    const encodedMessage = encodeURIComponent(message);
                    const phoneNumber = "+22892871605";
                    const whatsappUrl = `https://wa.me/${phoneNumber}?text=${encodedMessage}`;
                    
                    window.open(whatsappUrl, '_blank');
                    showNotification("Message préparé pour WhatsApp avec GPS", "success");
                });
            }
            
            // Bouton pour générer une carte
            const generateMapBtn = document.getElementById('generateMapBtn');
            if (generateMapBtn) {
                generateMapBtn.addEventListener('click', function() {
                    if (cartes.length === 0) {
                        showNotification("Aucune fiche enregistrée", "warning");
                        return;
                    }
                    
                    showNotification("Fonctionnalité en développement", "info");
                });
            }
            
            // Bouton pour effacer le formulaire d'activité
            const clearActivityForm = document.getElementById('clearActivityForm');
            if (clearActivityForm) {
                clearActivityForm.addEventListener('click', function() {
                    const form = document.getElementById('activityForm');
                    if (form) {
                        form.reset();
                        showNotification("Formulaire effacé", "info");
                    }
                });
            }
            
            // Boutons d'import/export
            const importBtn = document.getElementById('importBtn');
            const exportBtn = document.getElementById('exportBtn');
            const whatsappBtn = document.getElementById('whatsappBtn');
            
            if (importBtn) {
                importBtn.addEventListener('click', function() {
                    if (!isAuthenticated) {
                        showNotification("Veuillez vous connecter", "warning");
                        return;
                    }
                    document.getElementById('fileInput').click();
                });
            }
            
            if (exportBtn) {
                exportBtn.addEventListener('click', function() {
                    if (!isAuthenticated) {
                        showNotification("Veuillez vous connecter", "warning");
                        return;
                    }
                    
                    if (preachings.length === 0) {
                        showNotification("Aucune donnée à exporter", "warning");
                        return;
                    }
                    
                    const dataStr = JSON.stringify(preachings, null, 2);
                    const dataBlob = new Blob([dataStr], {type: 'application/json'});
                    const url = URL.createObjectURL(dataBlob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `prechons_${new Date().toISOString().split('T')[0]}.json`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                    
                    showNotification("Données exportées avec succès!", "success");
                });
            }
            
            if (whatsappBtn) {
                whatsappBtn.addEventListener('click', function() {
                    if (!isAuthenticated) {
                        showNotification("Veuillez vous connecter", "warning");
                        return;
                    }
                    
                    const form = document.getElementById('preachingForm');
                    if (!form) return;
                    
                    const formData = new FormData(form);
                    const data = Object.fromEntries(formData.entries());
                    
                    if (!data.date || !data.location || !data.group) {
                        showNotification("Remplissez les champs obligatoires", "warning");
                        return;
                    }
                    
                    let message = `*NOUVELLE PRÉDICATION*\n\n`;
                    message += `📅 *Date:* ${data.date}\n`;
                    message += `📍 *Lieu:* ${data.location}\n`;
                    message += `👥 *Groupe:* ${data.group}\n`;
                    message += `🏘️ *Quartier:* ${data.neighborhood || 'Non spécifié'}\n`;
                    
                    // Ajouter les coordonnées GPS si disponibles
                    const lat = document.getElementById('latitude').value;
                    const lon = document.getElementById('longitude').value;
                    if (lat && lon) {
                        message += `📍 *Coordonnées GPS:* ${lat}, ${lon}\n`;
                        message += `🗺️ *Lien carte:* ${generateGoogleMapsLink(lat, lon)}\n`;
                    }
                    
                    // Ajouter le lien de trajectoire si disponible
                    const trajectoryLink = generateTrajectoryLink();
                    if (trajectoryLink) {
                        message += `🛤️ *Trajectoire:* ${trajectoryLink}\n`;
                        message += `📊 *Points enregistrés:* ${trajectoryPoints.length}\n`;
                    }
                    
                    const encodedMessage = encodeURIComponent(message);
                    const phoneNumber = "+22892871605";
                    const whatsappUrl = `https://wa.me/${phoneNumber}?text=${encodedMessage}`;
                    
                    window.open(whatsappUrl, '_blank');
                    showNotification("Message préparé pour WhatsApp avec GPS", "success");
                });
            }
            
            // ===========================================
            // GESTION DU FORMULAIRE DE RAPPORT D'ACTIVITÉ
            // ===========================================
            
            // Bouton de prévisualisation du rapport
            const previsualiserRapportBtn = document.getElementById('previsualiserRapport');
            if (previsualiserRapportBtn) {
                previsualiserRapportBtn.addEventListener('click', function() {
                    previsualiserRapport();
                });
            }
            
            // Bouton d'envoi du rapport par WhatsApp
            const envoyerRapportBtn = document.getElementById('envoyerRapportWhatsApp');
            if (envoyerRapportBtn) {
                envoyerRapportBtn.addEventListener('click', function() {
                    envoyerRapportWhatsApp();
                });
            }
            
            // Bouton de sauvegarde du rapport
            const sauvegarderRapportBtn = document.getElementById('sauvegarderRapport');
            if (sauvegarderRapportBtn) {
                sauvegarderRapportBtn.addEventListener('click', function() {
                    sauvegarderRapport();
                });
            }
            
            // Gestion du formulaire de rapport
            const rapportForm = document.getElementById('rapportForm');
            if (rapportForm) {
                rapportForm.addEventListener('submit', function(event) {
                    event.preventDefault();
                    sauvegarderRapport();
                });
            }
            
            // ===========================================
            // GESTION DU FORMULAIRE DE RÉUNION
            // ===========================================
            
            // Bouton de prévisualisation de la réunion
            const previsualiserReunionBtn = document.getElementById('previsualiserReunion');
            if (previsualiserReunionBtn) {
                previsualiserReunionBtn.addEventListener('click', function() {
                    previsualiserReunion();
                });
            }
            
            // Bouton d'envoi de la réunion par WhatsApp
            const envoyerReunionBtn = document.getElementById('envoyerReunionWhatsApp');
            if (envoyerReunionBtn) {
                envoyerReunionBtn.addEventListener('click', function() {
                    envoyerReunionWhatsApp();
                });
            }
            
            // Bouton de sauvegarde de la réunion
            const sauvegarderReunionBtn = document.getElementById('sauvegarderReunion');
            if (sauvegarderReunionBtn) {
                sauvegarderReunionBtn.addEventListener('click', function() {
                    sauvegarderReunion();
                });
            }
            
            // Bouton pour tester le lien WhatsApp
            const testWhatsappLinkBtn = document.getElementById('testWhatsappLink');
            if (testWhatsappLinkBtn) {
                testWhatsappLinkBtn.addEventListener('click', function() {
                    const link = document.getElementById('whatsappGroupLink').value;
                    if (link && link.startsWith('http')) {
                        window.open(link, '_blank');
                        showNotification("Ouverture du lien WhatsApp...", "info");
                    } else {
                        showNotification("Veuillez entrer un lien WhatsApp valide", "warning");
                    }
                });
            }
            
            // Gestion du formulaire de réunion
            const reunionForm = document.getElementById('reunionForm');
            if (reunionForm) {
                reunionForm.addEventListener('submit', function(event) {
                    event.preventDefault();
                    sauvegarderReunion();
                });
            }
        }
        
        // Fonction pour prévisualiser le rapport
        function previsualiserRapport() {
            const form = document.getElementById('rapportForm');
            if (!form) return;
            
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());
            
            // Validation des champs obligatoires
            if (!data.rapportNom || !data.rapportPrenoms || !data.rapportCongregation || 
                !data.rapportVille || !data.rapportGroupe || !data.rapportMois || !data.aPreche) {
                showNotification("Veuillez remplir tous les champs obligatoires", "warning");
                return;
            }
            
            // Formater le mois
            const mois = data.rapportMois;
            const [annee, moisNum] = mois.split('-');
            const moisNoms = [
                'Janvier', 'Février', 'Mars', 'Avril', 'Mai', 'Juin',
                'Juillet', 'Août', 'Septembre', 'Octobre', 'Novembre', 'Décembre'
            ];
            const moisFormate = `${moisNoms[parseInt(moisNum) - 1]} ${annee}`;
            
            // Récupérer les types d'activités cochées
            const typesActivites = [];
            if (data.typePresentoir) typesActivites.push("Présentoir");
            if (data.typeFormelle) typesActivites.push("Formelle");
            if (data.typeInformelle) typesActivites.push("Informelle");
            if (data.typePublique) typesActivites.push("Publique");
            if (data.typeLieuPublic) typesActivites.push("Visite de lieu public");
            if (data.typePrison) typesActivites.push("Visite dans une prison");
            if (data.typeAdministratif) typesActivites.push("Lieux administratifs");
            
            // Créer le contenu de prévisualisation
            let previewHTML = `
                <div style="font-family: Arial, sans-serif;">
                    <h2 style="color: #1a472a; text-align: center; margin-bottom: 20px;">
                        <i class="fas fa-file-alt"></i> RAPPORT D'ACTIVITÉ
                    </h2>
                    
                    <div style="background-color: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h3 style="color: #2e7d32; margin-bottom: 10px;">
                            <i class="fas fa-user-circle"></i> INFORMATIONS PERSONNELLES
                        </h3>
                        <p><strong>Nom :</strong> ${data.rapportNom}</p>
                        <p><strong>Prénoms :</strong> ${data.rapportPrenoms}</p>
                        <p><strong>Congrégation :</strong> ${data.rapportCongregation}</p>
                        <p><strong>Ville :</strong> ${data.rapportVille}</p>
                        <p><strong>Groupe de prédication :</strong> ${data.rapportGroupe}</p>
                        <p><strong>Mois de l'activité :</strong> ${moisFormate}</p>
                    </div>
                    
                    <div style="background-color: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h3 style="color: #2e7d32; margin-bottom: 10px;">
                            <i class="fas fa-bullhorn"></i> ACTIVITÉS DE PRÉDICATION
                        </h3>
                        <p><strong>A prêché ce mois :</strong> ${data.aPreche === 'oui' ? '✅ OUI' : '❌ NON'}</p>
                        
                        ${typesActivites.length > 0 ? `
                        <p><strong>Types d'activités menées :</strong></p>
                        <ul style="padding-left: 20px;">
                            ${typesActivites.map(type => `<li>${type}</li>`).join('')}
                        </ul>
                        ` : '<p><strong>Aucun type d\'activité sélectionné</strong></p>'}
                    </div>
                    
                    <div style="background-color: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h3 style="color: #2e7d32; margin-bottom: 10px;">
                            <i class="fas fa-book-open"></i> ÉTUDES BIBLIQUES
                        </h3>
                        <p><strong>Études nouvelles :</strong> ${data.etudesNouvelles || 0}</p>
                        <p><strong>Études anciennes :</strong> ${data.etudesAnciennes || 0}</p>
                        <p><strong>Total des études :</strong> ${(parseInt(data.etudesNouvelles) || 0) + (parseInt(data.etudesAnciennes) || 0)}</p>
                    </div>
                    
                    <div style="background-color: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h3 style="color: #2e7d32; margin-bottom: 10px;">
                            <i class="fas fa-chart-line"></i> FRÉQUENCE DES ACTIVITÉS
                        </h3>
                        ${data.nbPresentoir ? `<p><strong>Présentoir :</strong> ${data.nbPresentoir} fois</p>` : ''}
                        ${data.nbFormelle ? `<p><strong>Formelle :</strong> ${data.nbFormelle} fois</p>` : ''}
                        ${data.nbInformelle ? `<p><strong>Informelle :</strong> ${data.nbInformelle} fois</p>` : ''}
                        ${data.nbPublique ? `<p><strong>Publique :</strong> ${data.nbPublique} fois</p>` : ''}
                    </div>
            `;
            
            if (data.rapportObservations) {
                previewHTML += `
                    <div style="background-color: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h3 style="color: #2e7d32; margin-bottom: 10px;">
                            <i class="fas fa-sticky-note"></i> OBSERVATIONS
                        </h3>
                        <p>${data.rapportObservations.replace(/\n/g, '<br>')}</p>
                    </div>
                `;
            }
            
            previewHTML += `
                    <div style="background-color: #e8f5e9; padding: 15px; border-radius: 8px; text-align: center; margin-top: 20px;">
                        <p style="color: #1a472a; font-weight: bold;">
                            <i class="fas fa-info-circle"></i> Ce rapport sera envoyé au : ${data.whatsappNumber}
                        </p>
                        <p style="font-size: 0.9rem; color: #555;">
                            Date de génération : ${new Date().toLocaleDateString('fr-FR')}
                        </p>
                    </div>
                </div>
            `;
            
            // Afficher la prévisualisation
            const previewContainer = document.getElementById('rapportPreview');
            const previewSection = document.getElementById('previsualisationRapport');
            
            if (previewContainer && previewSection) {
                previewContainer.innerHTML = previewHTML;
                previewSection.style.display = 'block';
                previewSection.scrollIntoView({ behavior: 'smooth' });
                
                showNotification("Rapport prévisualisé avec succès", "success");
            }
        }
        
        // Fonction pour envoyer le rapport par WhatsApp
        function envoyerRapportWhatsApp() {
            const form = document.getElementById('rapportForm');
            if (!form) return;
            
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());
            
            // Validation des champs obligatoires
            if (!data.rapportNom || !data.rapportPrenoms || !data.rapportCongregation || 
                !data.rapportVille || !data.rapportGroupe || !data.rapportMois || !data.aPreche) {
                showNotification("Veuillez remplir tous les champs obligatoires", "warning");
                return;
            }
            
            // Formater le mois
            const mois = data.rapportMois;
            const [annee, moisNum] = mois.split('-');
            const moisNoms = [
                'Janvier', 'Février', 'Mars', 'Avril', 'Mai', 'Juin',
                'Juillet', 'Août', 'Septembre', 'Octobre', 'Novembre', 'Décembre'
            ];
            const moisFormate = `${moisNoms[parseInt(moisNum) - 1]} ${annee}`;
            
            // Récupérer les types d'activités cochées
            const typesActivites = [];
            if (data.typePresentoir) typesActivites.push("Présentoir");
            if (data.typeFormelle) typesActivites.push("Formelle");
            if (data.typeInformelle) typesActivites.push("Informelle");
            if (data.typePublique) typesActivites.push("Publique");
            if (data.typeLieuPublic) typesActivites.push("Visite de lieu public");
            if (data.typePrison) typesActivites.push("Visite dans une prison");
            if (data.typeAdministratif) typesActivites.push("Lieux administratifs");
            
            // Créer le message WhatsApp
            let message = `*📋 RAPPORT D'ACTIVITÉ MENSUEL*\n\n`;
            
            message += `*📌 INFORMATIONS PERSONNELLES*\n`;
            message += `👤 *Nom :* ${data.rapportNom}\n`;
            message += `👥 *Prénoms :* ${data.rapportPrenoms}\n`;
            message += `⛪ *Congrégation :* ${data.rapportCongregation}\n`;
            message += `🏙️ *Ville :* ${data.rapportVille}\n`;
            message += `👨‍👩‍👧‍👦 *Groupe de prédication :* ${data.rapportGroupe}\n`;
            message += `📅 *Mois de l'activité :* ${moisFormate}\n\n`;
            
            message += `*📢 ACTIVITÉS DE PRÉDICATION*\n`;
            message += `🎯 *A prêché ce mois :* ${data.aPreche === 'oui' ? '✅ OUI' : '❌ NON'}\n`;
            
            if (typesActivites.length > 0) {
                message += `📝 *Types d'activités menées :*\n`;
                typesActivites.forEach(type => {
                    message += `   • ${type}\n`;
                });
            } else {
                message += `📝 *Aucun type d'activité sélectionné*\n`;
            }
            message += `\n`;
            
            message += `*📖 ÉTUDES BIBLIQUES*\n`;
            message += `⭐ *Études nouvelles :* ${data.etudesNouvelles || 0}\n`;
            message += `📚 *Études anciennes :* ${data.etudesAnciennes || 0}\n`;
            const totalEtudes = (parseInt(data.etudesNouvelles) || 0) + (parseInt(data.etudesAnciennes) || 0);
            message += `🔢 *Total des études :* ${totalEtudes}\n\n`;
            
            message += `*📊 FRÉQUENCE DES ACTIVITÉS*\n`;
            if (data.nbPresentoir) message += `🛒 *Présentoir :* ${data.nbPresentoir} fois\n`;
            if (data.nbFormelle) message += `👔 *Formelle :* ${data.nbFormelle} fois\n`;
            if (data.nbInformelle) message += `💬 *Informelle :* ${data.nbInformelle} fois\n`;
            if (data.nbPublique) message += `📣 *Publique :* ${data.nbPublique} fois\n`;
            message += `\n`;
            
            if (data.rapportObservations) {
                message += `*📝 OBSERVATIONS*\n`;
                message += `${data.rapportObservations}\n\n`;
            }
            
            message += `_Rapport généré via l'application "Prêchons"_\n`;
            message += `📅 Date : ${new Date().toLocaleDateString('fr-FR')}`;
            
            // Récupérer le numéro WhatsApp
            let phoneNumber = data.whatsappNumber || "+22892871605";
            
            // Nettoyer le numéro (supprimer les espaces et le + si présent)
            phoneNumber = phoneNumber.replace(/\s+/g, '').replace(/^\+/, '');
            
            // Vérifier le format du numéro
            if (!phoneNumber.match(/^\d{9,15}$/)) {
                showNotification("Numéro WhatsApp invalide. Format attendu : 22892871605", "error");
                return;
            }
            
            // Encoder le message pour l'URL
            const encodedMessage = encodeURIComponent(message);
            
            // Créer l'URL WhatsApp
            const whatsappUrl = `https://wa.me/${phoneNumber}?text=${encodedMessage}`;
            
            // Ouvrir WhatsApp dans une nouvelle fenêtre
            window.open(whatsappUrl, '_blank');
            
            showNotification(`Rapport préparé pour WhatsApp (${phoneNumber})`, "success");
        }
        
        // Fonction pour sauvegarder le rapport
        function sauvegarderRapport() {
            const form = document.getElementById('rapportForm');
            if (!form) return;
            
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());
            
            // Validation des champs obligatoires
            if (!data.rapportNom || !data.rapportPrenoms || !data.rapportCongregation || 
                !data.rapportVille || !data.rapportGroupe || !data.rapportMois || !data.aPreche) {
                showNotification("Veuillez remplir tous les champs obligatoires", "warning");
                return;
            }
            
            // Ajouter un timestamp et un ID
            data.timestamp = new Date().toISOString();
            data.id = Date.now();
            
            // Ajouter aux rapports existants
            rapports.push(data);
            
            // Sauvegarder dans le localStorage
            localStorage.setItem('rapports', JSON.stringify(rapports));
            
            // Réinitialiser le formulaire
            form.reset();
            
            // Remettre le mois courant par défaut
            const currentMonth = new Date().toISOString().slice(0, 7);
            document.getElementById('rapportMois').value = currentMonth;
            
            // Remettre le numéro WhatsApp par défaut
            document.getElementById('whatsappNumber').value = "+22892871605";
            
            showNotification("Rapport sauvegardé avec succès!", "success");
        }
        
        // Fonction pour prévisualiser la réunion
        function previsualiserReunion() {
            const form = document.getElementById('reunionForm');
            if (!form) return;
            
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());
            
            // Créer le contenu de prévisualisation
            let previewHTML = `
                <div style="font-family: Arial, sans-serif;">
                    <h2 style="color: #1a472a; text-align: center; margin-bottom: 20px;">
                        <i class="fas fa-users"></i> PROGRAMME DES RÉUNIONS
                    </h2>
            `;
            
            // Section Réunions Principales
            if (data.discoursBibliqueTheme || data.tourDeGardeTheme) {
                previewHTML += `
                    <div style="background-color: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h3 style="color: #2e7d32; margin-bottom: 10px;">
                            <i class="fas fa-church"></i> RÉUNIONS PRINCIPALES
                        </h3>
                `;
                
                if (data.discoursBibliqueTheme) {
                    previewHTML += `<p><strong>Discours Biblique :</strong> ${data.discoursBibliqueTheme}</p>`;
                }
                
                if (data.tourDeGardeTheme) {
                    previewHTML += `<p><strong>Tour de Garde :</strong> ${data.tourDeGardeTheme}</p>`;
                }
                
                previewHTML += `</div>`;
            }
            
            // Section Semaine Spatiale
            if (data.semaineSpatialeDate || data.surveillantVisite || data.periodesRendezVous) {
                previewHTML += `
                    <div style="background-color: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h3 style="color: #2e7d32; margin-bottom: 10px;">
                            <i class="fas fa-calendar-week"></i> SEMAINE SPATIALE
                        </h3>
                `;
                
                if (data.semaineSpatialeDate) {
                    const date = new Date(data.semaineSpatialeDate);
                    previewHTML += `<p><strong>Date de la semaine :</strong> ${date.toLocaleDateString('fr-FR')}</p>`;
                }
                
                if (data.surveillantVisite) {
                    previewHTML += `<p><strong>Surveillant en visite :</strong> ${data.surveillantVisite}</p>`;
                }
                
                if (data.debutReunionDate && data.debutReunionHeure) {
                    const dateDebut = new Date(data.debutReunionDate);
                    previewHTML += `<p><strong>Début de la réunion :</strong> ${dateDebut.toLocaleDateString('fr-FR')} à ${data.debutReunionHeure}</p>`;
                }
                
                if (data.periodesRendezVous) {
                    previewHTML += `<p><strong>Rendez-vous :</strong></p>`;
                    previewHTML += `<div style="white-space: pre-line; background-color: white; padding: 10px; border-radius: 5px; margin-top: 5px;">${data.periodesRendezVous}</div>`;
                }
                
                previewHTML += `</div>`;
            }
            
            // Section Assemblée
            if (data.assembleeTheme || data.assembleeType || data.assembleeLieu || data.assembleeHeureDebut) {
                previewHTML += `
                    <div style="background-color: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h3 style="color: #2e7d32; margin-bottom: 10px;">
                            <i class="fas fa-users"></i> ASSEMBLÉE
                        </h3>
                `;
                
                if (data.assembleeTheme) {
                    previewHTML += `<p><strong>Thème :</strong> ${data.assembleeTheme}</p>`;
                }
                
                if (data.assembleeType) {
                    previewHTML += `<p><strong>Type :</strong> ${data.assembleeType}</p>`;
                }
                
                if (data.assembleeLieu) {
                    previewHTML += `<p><strong>Lieu :</strong> ${data.assembleeLieu}</p>`;
                }
                
                if (data.assembleeHeureDebut) {
                    previewHTML += `<p><strong>Heure du début :</strong> ${data.assembleeHeureDebut}</p>`;
                }
                
                previewHTML += `</div>`;
            }
            
            // Section Étude de la semaine - Partie 1
            const parties1 = [];
            if (data.joyauxParole) parties1.push({titre: "Joyaux de la Parole", valeur: data.joyauxParole});
            if (data.perlesSpirituelles) parties1.push({titre: "Perles Spirituelles", valeur: data.perlesSpirituelles});
            if (data.lectureBible) parties1.push({titre: "Lecture de la Bible", valeur: data.lectureBible});
            if (data.appliqueMinistry) parties1.push({titre: "Applique-toi au ministère", valeur: data.appliqueMinistry});
            if (data.sujet4) parties1.push({titre: "Sujet 4", valeur: data.sujet4});
            if (data.sujet5) parties1.push({titre: "Sujet 5", valeur: data.sujet5});
            if (data.sujet6) parties1.push({titre: "Sujet 6", valeur: data.sujet6});
            
            if (parties1.length > 0) {
                previewHTML += `
                    <div style="background-color: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h3 style="color: #2e7d32; margin-bottom: 10px;">
                            <i class="fas fa-book-open"></i> ÉTUDE DE LA SEMAINE - PARTIE 1
                        </h3>
                `;
                
                parties1.forEach(partie => {
                    previewHTML += `<p><strong>${partie.titre} :</strong> ${partie.valeur}</p>`;
                });
                
                previewHTML += `</div>`;
            }
            
            // Section Étude de la semaine - Partie 2
            const parties2 = [];
            if (data.vieChretienne) parties2.push({titre: "Vie Chrétienne", valeur: data.vieChretienne});
            if (data.etudeBibliqueAssemblee) parties2.push({titre: "Étude Biblique de l'assemblée", valeur: data.etudeBibliqueAssemblee});
            
            if (parties2.length > 0) {
                previewHTML += `
                    <div style="background-color: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h3 style="color: #2e7d32; margin-bottom: 10px;">
                            <i class="fas fa-heart"></i> ÉTUDE DE LA SEMAINE - PARTIE 2
                        </h3>
                `;
                
                parties2.forEach(partie => {
                    previewHTML += `<p><strong>${partie.titre} :</strong> ${partie.valeur}</p>`;
                });
                
                previewHTML += `</div>`;
            }
            
            // Lien WhatsApp
            previewHTML += `
                    <div style="background-color: #e8f5e9; padding: 15px; border-radius: 8px; text-align: center; margin-top: 20px;">
                        <p style="color: #1a472a; font-weight: bold;">
                            <i class="fas fa-info-circle"></i> Ce programme sera envoyé au groupe WhatsApp
                        </p>
                        <p style="font-size: 0.9rem; color: #555;">
                            Lien : ${data.whatsappGroupLink || 'Non spécifié'}
                        </p>
                        <p style="font-size: 0.9rem; color: #555;">
                            Date de génération : ${new Date().toLocaleDateString('fr-FR')}
                        </p>
                    </div>
                </div>
            `;
            
            // Afficher la prévisualisation
            const previewContainer = document.getElementById('reunionPreview');
            const previewSection = document.getElementById('previsualisationReunion');
            
            if (previewContainer && previewSection) {
                previewContainer.innerHTML = previewHTML;
                previewSection.style.display = 'block';
                previewSection.scrollIntoView({ behavior: 'smooth' });
                
                showNotification("Programme prévisualisé avec succès", "success");
            }
        }
        
        // Fonction pour envoyer la réunion par WhatsApp
        function envoyerReunionWhatsApp() {
            const form = document.getElementById('reunionForm');
            if (!form) return;
            
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());
            
            // Créer le message WhatsApp
            let message = `*📅 PROGRAMME DES RÉUNIONS*\n\n`;
            
            // Réunions Principales
            if (data.discoursBibliqueTheme || data.tourDeGardeTheme) {
                message += `*⛪ RÉUNIONS PRINCIPALES*\n`;
                if (data.discoursBibliqueTheme) {
                    message += `📖 *Discours Biblique :* ${data.discoursBibliqueTheme}\n`;
                }
                if (data.tourDeGardeTheme) {
                    message += `🏰 *Tour de Garde :* ${data.tourDeGardeTheme}\n`;
                }
                message += `\n`;
            }
            
            // Semaine Spatiale
            if (data.semaineSpatialeDate || data.surveillantVisite) {
                message += `*📆 SEMAINE SPATIALE*\n`;
                if (data.semaineSpatialeDate) {
                    const date = new Date(data.semaineSpatialeDate);
                    message += `📅 *Date :* ${date.toLocaleDateString('fr-FR')}\n`;
                }
                if (data.surveillantVisite) {
                    message += `👨‍💼 *Surveillant en visite :* ${data.surveillantVisite}\n`;
                }
                if (data.debutReunionDate && data.debutReunionHeure) {
                    const dateDebut = new Date(data.debutReunionDate);
                    message += `⏰ *Début :* ${dateDebut.toLocaleDateString('fr-FR')} à ${data.debutReunionHeure}\n`;
                }
                if (data.periodesRendezVous) {
                    message += `📍 *Rendez-vous :*\n${data.periodesRendezVous}\n`;
                }
                message += `\n`;
            }
            
            // Assemblée
            if (data.assembleeTheme) {
                message += `*🙏 ASSEMBLÉE*\n`;
                message += `✨ *Thème :* ${data.assembleeTheme}\n`;
                if (data.assembleeType) message += `📋 *Type :* ${data.assembleeType}\n`;
                if (data.assembleeLieu) message += `🏛️ *Lieu :* ${data.assembleeLieu}\n`;
                if (data.assembleeHeureDebut) message += `⏰ *Heure début :* ${data.assembleeHeureDebut}\n`;
                message += `\n`;
            }
            
            // Étude de la semaine - Partie 1
            const parties1 = [];
            if (data.joyauxParole) parties1.push({titre: "Joyaux de la Parole", valeur: data.joyauxParole});
            if (data.perlesSpirituelles) parties1.push({titre: "Perles Spirituelles", valeur: data.perlesSpirituelles});
            if (data.lectureBible) parties1.push({titre: "Lecture de la Bible", valeur: data.lectureBible});
            if (data.appliqueMinistry) parties1.push({titre: "Applique-toi au ministère", valeur: data.appliqueMinistry});
            if (data.sujet4) parties1.push({titre: "Sujet 4", valeur: data.sujet4});
            if (data.sujet5) parties1.push({titre: "Sujet 5", valeur: data.sujet5});
            if (data.sujet6) parties1.push({titre: "Sujet 6", valeur: data.sujet6});
            
            if (parties1.length > 0) {
                message += `*📚 ÉTUDE DE LA SEMAINE - PARTIE 1*\n`;
                parties1.forEach(partie => {
                    message += `• *${partie.titre} :* ${partie.valeur}\n`;
                });
                message += `\n`;
            }
            
            // Étude de la semaine - Partie 2
            const parties2 = [];
            if (data.vieChretienne) parties2.push({titre: "Vie Chrétienne", valeur: data.vieChretienne});
            if (data.etudeBibliqueAssemblee) parties2.push({titre: "Étude Biblique de l'assemblée", valeur: data.etudeBibliqueAssemblee});
            
            if (parties2.length > 0) {
                message += `*❤️ ÉTUDE DE LA SEMAINE - PARTIE 2*\n`;
                parties2.forEach(partie => {
                    message += `• *${partie.titre} :* ${partie.valeur}\n`;
                });
                message += `\n`;
            }
            
            // Message complémentaire
            if (data.messageComplementaire) {
                message += `*💬 MESSAGE COMPLÉMENTAIRE*\n`;
                message += `${data.messageComplementaire}\n\n`;
            }
            
            message += `_Programme généré via l'application "Prêchons"_\n`;
            message += `📅 Date : ${new Date().toLocaleDateString('fr-FR')}`;
            
            // Vérifier si un lien WhatsApp est fourni
            let whatsappLink = data.whatsappGroupLink;
            
            if (whatsappLink && whatsappLink.startsWith('https://chat.whatsapp.com/')) {
                // Ouvrir le lien du groupe
                window.open(whatsappLink, '_blank');
                
                // Copier le message dans le presse-papier pour faciliter le collage
                navigator.clipboard.writeText(message).then(() => {
                    showNotification("Message copié dans le presse-papier! Collez-le dans le groupe WhatsApp.", "success");
                }).catch(err => {
                    console.error('Erreur lors de la copie:', err);
                    showNotification("Lien WhatsApp ouvert! Copiez le message manuellement.", "info");
                });
            } else {
                // Si pas de lien, ouvrir WhatsApp avec le message
                const encodedMessage = encodeURIComponent(message);
                const whatsappUrl = `https://wa.me/?text=${encodedMessage}`;
                window.open(whatsappUrl, '_blank');
                showNotification("Message préparé pour WhatsApp", "success");
            }
        }
        
        // Fonction pour sauvegarder la réunion
        function sauvegarderReunion() {
            const form = document.getElementById('reunionForm');
            if (!form) return;
            
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());
            
            // Ajouter un timestamp et un ID
            data.timestamp = new Date().toISOString();
            data.id = Date.now();
            
            // Ajouter aux réunions existantes
            reunions.push(data);
            
            // Sauvegarder dans le localStorage
            localStorage.setItem('reunions', JSON.stringify(reunions));
            
            showNotification("Programme de réunion sauvegardé avec succès!", "success");
        }
        
        // Fonction pour afficher une notification
        function showNotification(message, type = "info") {
            const notification = document.getElementById('notification');
            if (!notification) return;
            
            notification.textContent = message;
            
            if (type === "success") {
                notification.style.backgroundColor = "#388e3c";
            } else if (type === "error") {
                notification.style.backgroundColor = "#d32f2f";
            } else if (type === "warning") {
                notification.style.backgroundColor = "#f57c00";
            } else {
                notification.style.backgroundColor = "#1976d2";
            }
            
            notification.style.display = "block";
            
            setTimeout(() => {
                notification.style.display = "none";
            }, 4000);
        }
        
        // Fonction pour mettre à jour la liste des prédications
        function updatePreachingList() {
            const preachingList = document.getElementById('preachingList');
            if (!preachingList) return;
            
            if (preachings.length === 0) {
                preachingList.innerHTML = `
                    <div class="empty-list">
                        <i class="fas fa-calendar-times"></i>
                        <h3>Aucune prédication</h3>
                        <p>Ajoutez une prédication</p>
                    </div>
                `;
                return;
            }
            
            const sortedPreachings = [...preachings].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            preachingList.innerHTML = sortedPreachings.map(preaching => `
                <div class="list-item">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <div style="font-weight: bold; color: #1a472a;">
                            <i class="fas fa-calendar-alt"></i> ${preaching.date || 'Non spécifiée'}
                        </div>
                        <div style="color: #64748b;">
                            <i class="fas fa-map-marker-alt"></i> ${preaching.location || 'Non spécifié'}
                        </div>
                    </div>
                    <div style="margin-bottom: 5px;">
                        <strong>Quartier:</strong> ${preaching.neighborhood || 'Non spécifié'}
                    </div>
                    <div style="display: inline-block; background-color: #e2e8f0; padding: 4px 10px; border-radius: 15px; font-size: 0.85rem;">
                        <i class="fas fa-users"></i> ${preaching.group || 'Non spécifié'}
                    </div>
                    ${preaching.gps ? `
                    <div style="margin-top: 10px; padding: 10px; background-color: #e8f5e9; border-radius: 6px; font-size: 0.9rem;">
                        <div style="color: #1a472a; font-weight: bold; margin-bottom: 5px;">
                            <i class="fas fa-map-marker-alt"></i> Coordonnées GPS
                        </div>
                        <div style="font-size: 0.85rem;">
                            Lat: ${preaching.gps.latitude ? preaching.gps.latitude.toFixed(6) : 'N/A'}, 
                            Lon: ${preaching.gps.longitude ? preaching.gps.longitude.toFixed(6) : 'N/A'}
                        </div>
                    </div>
                    ` : ''}
                    ${preaching.preaching ? `<div style="margin-top: 10px; padding: 10px; background-color: #f8f9fa; border-radius: 6px; font-size: 0.9rem;">${preaching.preaching}</div>` : ''}
                </div>
            `).join('');
        }
        
        // Fonction pour mettre à jour la liste des activités
        function updateActivityList() {
            const activityList = document.getElementById('activityList');
            if (!activityList) return;
            
            if (activities.length === 0) {
                activityList.innerHTML = `
                    <div class="empty-list">
                        <i class="fas fa-book-open"></i>
                        <h3>Cahier d'activité vide</h3>
                        <p>Ajoutez votre première entrée</p>
                    </div>
                `;
                return;
            }
            
            const sortedActivities = [...activities].sort((a, b) => new Date(a.nextVisitDate) - new Date(b.nextVisitDate));
            
            activityList.innerHTML = sortedActivities.map(activity => `
                <div class="activity-item">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px; align-items: flex-start;">
                        <div style="font-weight: bold; color: #1a472a; font-size: 1.05rem;">
                            <i class="fas fa-user"></i> ${activity.personName || 'Non spécifié'}
                        </div>
                        <div style="color: #64748b; font-size: 0.85rem; background-color: #e2e8f0; padding: 4px 10px; border-radius: 15px;">
                            <i class="fas fa-calendar"></i> ${activity.nextVisitDate || 'Non spécifiée'}
                        </div>
                    </div>
                    <div style="color: #1a472a; margin: 8px 0; font-weight: 600;">
                        <i class="fas fa-book-open"></i> ${activity.theme || 'Non spécifié'}
                    </div>
                    <div style="color: #2e7d32; margin-top: 10px;">
                        <i class="fas fa-clock"></i> ${activity.nextVisitDate || 'Non spécifiée'} à ${activity.nextVisitTime || 'Non spécifiée'}
                    </div>
                    ${activity.gps ? `
                    <div style="margin-top: 10px; padding: 8px; background-color: #e3f2fd; border-radius: 5px; font-size: 0.85rem;">
                        <div style="color: #1976d2; font-weight: bold;">
                            <i class="fas fa-map-marker-alt"></i> Position GPS
                        </div>
                        <div style="font-size: 0.8rem;">
                            ${activity.gps.latitude ? activity.gps.latitude.toFixed(6) : 'N/A'}, 
                            ${activity.gps.longitude ? activity.gps.longitude.toFixed(6) : 'N/A'}
                        </div>
                    </div>
                    ` : ''}
                </div>
            `).join('');
        }
        
        // Fonction pour mettre à jour la liste des cartes
        function updateCarteList() {
            const carteList = document.getElementById('carteList');
            if (!carteList) return;
            
            if (cartes.length === 0) {
                carteList.innerHTML = `
                    <div class="empty-list">
                        <i class="fas fa-map"></i>
                        <h3>Aucune fiche</h3>
                        <p>Ajoutez votre première fiche</p>
                    </div>
                `;
                return;
            }
            
            const sortedCartes = [...cartes].sort((a, b) => (a.carteName || '').localeCompare(b.carteName || ''));
            
            carteList.innerHTML = sortedCartes.map(carte => `
                <div class="carte-item">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px; align-items: flex-start;">
                        <div style="font-weight: bold; color: #1a472a; font-size: 1.1rem;">
                            <i class="fas fa-user"></i> ${carte.carteName || 'Sans nom'}
                        </div>
                        <div style="color: #64748b; font-size: 0.85rem; background-color: #e2e8f0; padding: 4px 10px; border-radius: 15px;">
                            <i class="fas fa-users"></i> ${carte.carteType || 'Non spécifié'}
                        </div>
                    </div>
                    
                    <div style="color: #2e7d32; margin: 8px 0; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-phone"></i> <strong>Téléphone:</strong> 
                        <span>${carte.cartePhone || 'Non spécifié'}</span>
                    </div>
                    
                    ${carte.carteCongregation ? `
                    <div style="color: #1976d2; margin: 8px 0; font-weight: 600;">
                        <i class="fas fa-church"></i> ${carte.carteCongregation}
                    </div>
                    ` : ''}
                    
                    ${carte.gps ? `
                    <div style="margin-top: 10px; padding: 8px; background-color: #f3e5f5; border-radius: 5px; font-size: 0.85rem;">
                        <div style="color: #7b1fa2; font-weight: bold;">
                            <i class="fas fa-map-marker-alt"></i> Position GPS
                        </div>
                        <div style="font-size: 0.8rem;">
                            ${carte.gps.latitude ? carte.gps.latitude.toFixed(6) : 'N/A'}, 
                            ${carte.gps.longitude ? carte.gps.longitude.toFixed(6) : 'N/A'}
                        </div>
                    </div>
                    ` : ''}
                </div>
            `).join('');
        }
        
        // Fonction pour mettre à jour les statistiques
        function updateStatistics() {
            // Total des prédications
            const totalPreachings = document.getElementById('totalPreachings');
            if (totalPreachings) {
                totalPreachings.textContent = preachings.length;
            }
            
            // Groupes actifs
            const activeGroups = document.getElementById('activeGroups');
            if (activeGroups) {
                const uniqueGroups = [...new Set(preachings.map(p => p.group))].filter(g => g);
                activeGroups.textContent = uniqueGroups.length;
            }
            
            // Lieux différents
            const differentLocations = document.getElementById('differentLocations');
            if (differentLocations) {
                const uniqueLocations = [...new Set(preachings.map(p => p.location))].filter(l => l);
                differentLocations.textContent = uniqueLocations.length;
            }
            
            // Total des activités
            const totalActivities = document.getElementById('totalActivities');
            if (totalActivities) {
                totalActivities.textContent = activities.length;
            }
        }
    </script>
</body>
</html>
